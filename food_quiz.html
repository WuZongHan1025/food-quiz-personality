<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é£Ÿç‰©äººæ ¼æ¸¬é©—</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        /* CSS æ¨£å¼é–‹å§‹ */
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background: linear-gradient(135deg, #f0f8ff, #e0ffff); /* æ›´æŸ”å’Œçš„èƒŒæ™¯ */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            line-height: 1.6;
        }

        .container {
            background-color: #fff;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            max-width: 800px;
            width: 100%;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        /* éš±è—çš„å€å¡Š */
        .hidden {
            display: none !important;
        }

        /* æ­¡è¿é é¢æ¨™é¡Œå’Œæ¨™èª */
        .quiz-section h1,
        .quiz-section h2 { /* é‡å°æ‰€æœ‰ h1, h2 æ¨™é¡Œ */
            color: #4a4a4a;
            font-size: 2.2em;
            margin-bottom: 10px;
            text-align: center; /* ç½®ä¸­ */
            word-break: break-word; /* å…è¨±é•·å–®è©æ›è¡Œ */
            overflow-wrap: break-word; /* å…è¨±é•·å–®è©æ›è¡Œ */
        }
        .quiz-section .tagline {
            font-size: 1.1em;
            color: #666;
            margin-bottom: 30px;
        }

        /* å§“åè¼¸å…¥æç¤ºæ¨£å¼ */
        .user-name-input-group {
            margin-bottom: 20px;
            text-align: center;
        }
        .user-name-input-group label {
            display: block;
            font-size: 1.1em;
            margin-bottom: 10px;
            color: #555;
            font-weight: bold;
        }
        .input-field {
            width: calc(100% - 40px); /* è€ƒæ…® padding */
            padding: 12px 20px;
            margin: 8px 0;
            display: inline-block;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 1em;
            text-align: center; /* è¼¸å…¥æ¡†å…§æ–‡å­—ç½®ä¸­ */
        }
        .input-field::placeholder {
            color: #aaa;
        }
        .input-field:focus {
            border-color: #88c0d0;
            outline: none;
            box-shadow: 0 0 0 3px rgba(136, 192, 208, 0.3);
        }

        /* æŒ‰éˆ•é€šç”¨æ¨£å¼ */
        button {
            padding: 12px 25px;
            border: none;
            border-radius: 25px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            outline: none;
            margin: 5px; /* å¢åŠ æŒ‰éˆ•é–“è· */
        }

        .primary-btn {
            background-color: #88c0d0; /* åŒ—æ­è— */
            color: white;
            box-shadow: 0 4px 6px rgba(136, 192, 208, 0.3);
        }

        .primary-btn:hover {
            background-color: #639db5;
            transform: translateY(-2px);
            box-shadow: 0 6px 10px rgba(136, 192, 208, 0.4);
        }

        .nav-btn {
            background-color: #a3be8c; /* åŒ—æ­ç¶  */
            color: white;
            box-shadow: 0 4px 6px rgba(163, 190, 140, 0.3);
        }

        .nav-btn:hover {
            background-color: #8fa779;
            transform: translateY(-2px);
            box-shadow: 0 6px 10px rgba(163, 190, 140, 0.4);
        }

        .secondary-btn {
            background-color: #eceff4; /* åŒ—æ­æ·ºç° */
            color: #4c566a;
            border: 1px solid #d8dee9;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .secondary-btn:hover {
            background-color: #d8dee9;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        /* é€²åº¦æŒ‡ç¤ºå™¨ */
        .progress-indicator {
            text-align: center;
            font-size: 1.1em;
            color: #777;
            margin-bottom: 20px;
            padding: 10px;
            background-color: #f0f0f0;
            border-radius: 8px;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
        }

        /* æŒ‰éˆ•ç¦ç”¨ç‹€æ…‹ */
        .nav-btn.disabled {
            opacity: 0.6;
            cursor: not-allowed;
            background-color: #ccc; /* ç¦ç”¨æ™‚çš„èƒŒæ™¯è‰² */
            color: #666;
            transform: none; /* ç§»é™¤ hover æ•ˆæœ */
            box-shadow: none;
        }
        .nav-btn.disabled:hover {
            background-color: #ccc; /* ç¦ç”¨æ™‚ hover é¡è‰²ä¸è®Š */
            transform: none;
        }

        /* é¸é …æŒ‰éˆ• */
        .option-btn {
            background-color: #eceff4;
            color: #4c566a;
            border: 1px solid #d8dee9;
            width: 100%;
            text-align: left;
            margin-bottom: 10px;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .option-btn:hover {
            background-color: #d8dee9;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .option-btn.selected {
            background-color: #5e81ac; /* åŒ—æ­æ·±è— */
            color: white;
            border-color: #5e81ac;
            box-shadow: 0 4px 8px rgba(94, 129, 172, 0.3);
        }

        /* å•é¡Œå€å¡Š */
        .question-block {
            background-color: #f8f8f8;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            text-align: left;
        }

        .question-text {
            font-size: 1.2em;
            color: #3b4252; /* åŒ—æ­æ·±ç°è— */
            margin-bottom: 15px;
            font-weight: bold;
        }

        .options-container {
            display: flex;
            flex-direction: column;
            gap: 8px; /* å¢åŠ é¸é …é–“è· */
        }

        /* éšæ®µå¼•æ–‡ */
        .stage-intro {
            background-color: #e5e9f0; /* åŒ—æ­æ·ºç°è— */
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 30px;
            font-size: 1.05em;
            color: #4c566a;
            line-height: 1.6;
            box-shadow: inset 0 1px 4px rgba(0,0,0,0.08);
        }

        /* å°èˆªæŒ‰éˆ•å®¹å™¨ */
        .navigation-btns {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            padding: 0 10px;
        }

        /* çµæœé æ¨£å¼ */
        .result-display-area { /* æ–°çš„æˆªåœ–å€åŸŸæ¨£å¼ */
            padding: 20px;
            background-color: #fdfdfd;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            margin-bottom: 20px; /* èˆ‡ä¸‹æ–¹çš„å›é¥‹å€éš”é–‹ */
        }

        .result-title {
            color: #3b4252;
            font-size: 2em;
            margin-bottom: 15px;
        }

        .username-highlight {
            color: #bf616a; /* åŒ—æ­ç´… */
            font-weight: bold;
        }

        .food-personality-name {
            font-size: 2.8em;
            font-weight: bold;
            color: #ebcb8b; /* åŒ—æ­é»ƒ */
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .food-personality-name .emoji {
            font-size: 1.2em; /* è®“ emoji ç¨å¾®å¤§ä¸€é» */
            vertical-align: middle;
            margin-right: 5px;
        }

        .food-description {
            font-size: 1.1em;
            color: #4c566a;
            line-height: 1.6;
            margin-bottom: 30px;
        }

        /* æ–°å¢çš„å…¼å®¹æ€§é£Ÿç‰©ç¶²æ ¼å®¹å™¨ */
        .compatibility-sections-wrapper {
            display: flex; /* ä½¿ç”¨ flexbox è®“å…©å€‹å€å¡Šä¸¦æ’ */
            flex-wrap: wrap; /* å…è¨±åœ¨å°è¢å¹•ä¸Šæ›è¡Œ */
            gap: 20px; /* å…©å€‹å€å¡Šä¹‹é–“çš„é–“è· */
            margin-top: 25px;
        }

        .compatibility-section {
            flex: 1; /* è®“æ¯å€‹å€å¡Šå¹³å‡åˆ†é…ç©ºé–“ */
            min-width: 300px; /* æ¯å€‹å€å¡Šçš„æœ€å°å¯¬åº¦ï¼Œå°æ–¼æ­¤å¯¬åº¦æœƒæ›è¡Œ */
            text-align: left;
            background-color: #eff3f7; /* è¼•å¾®èƒŒæ™¯è‰² */
            padding: 15px;
            border-radius: 8px;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
        }

        .compatibility-section h3 {
            color: #5e81ac;
            font-size: 1.3em;
            margin-bottom: 15px;
            border-bottom: 2px solid #d8dee9;
            padding-bottom: 5px;
            text-align: center; /* å…¼å®¹æ€§å€å¡Šæ¨™é¡Œç½®ä¸­ */
        }

        .food-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); /* éŸ¿æ‡‰å¼ç¶²æ ¼ï¼šæœ€å°å¯¬åº¦ 140pxï¼Œè‡ªå‹•é©æ‡‰åˆ—æ•¸ */
            gap: 15px; /* é£Ÿç‰©å¡ç‰‡ä¹‹é–“çš„é–“è· */
            margin-top: 15px;
        }

        .food-card {
            background-color: #f5f5f5;
            padding: 12px;
            border-radius: 6px;
            color: #4c566a;
            line-height: 1.5;
            box-shadow: 0 1px 3px rgba(0,0,0,0.03);
            text-align: center; /* å¡ç‰‡å…§å®¹ç½®ä¸­ */
            display: flex; /* ä½¿ç”¨ flexbox å‚ç›´æ’ç‰ˆå¡ç‰‡å…§å®¹ */
            flex-direction: column;
            align-items: center; /* æ°´å¹³ç½®ä¸­å¡ç‰‡å…§å®¹ */
            justify-content: center; /* å‚ç›´ç½®ä¸­å¡ç‰‡å…§å®¹ */
        }

        .food-card strong {
            color: #bf616a; /* å¼·èª¿é£Ÿç‰©åç¨±é¡è‰² */
            font-size: 1.1em; /* è®“åç¨±ç¨å¾®å¤§ä¸€é» */
            margin-bottom: 5px;
        }

        .food-card .emoji {
            font-size: 2.5em; /* æ›´å¤§çš„ emoji */
            margin-bottom: 5px;
        }

        .food-card .reason-text {
            font-size: 0.9em;
            color: #555;
        }


        .feedback-section {
            margin-top: 30px;
            text-align: center;
            background-color: #e5e9f0;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        .feedback-section h3 {
            color: #3b4252;
            font-size: 1.3em;
            margin-bottom: 20px;
        }

        .feedback-buttons {
            display: flex;
            justify-content: center;
            flex-wrap: wrap; /* æ›è¡Œé¡¯ç¤ºæŒ‰éˆ• */
            gap: 15px; /* æŒ‰éˆ•é–“è· */
        }

        .feedback-buttons button {
            background-color: #88c0d0;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 1em;
            box-shadow: 0 3px 5px rgba(0,0,0,0.1);
        }
        .feedback-buttons button:hover {
            background-color: #639db5;
            transform: translateY(-1px);
        }
        .feedback-buttons button.active {
            background-color: #a3be8c; /* é¸æ“‡å¾Œè®Šç¶ è‰² */
            transform: scale(1.05);
            box-shadow: 0 5px 10px rgba(0,0,0,0.2);
        }
        .feedback-buttons button:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            background-color: #ccc;
            transform: none;
            box-shadow: none;
        }

        .result-actions {
            margin-top: 25px;
            display: flex;
            justify-content: center; /* è®“æŒ‰éˆ•ç½®ä¸­ */
            gap: 20px;
        }

        /* åœ–ç‰‡é è¦½å’Œæç¤º */
        #image-display-area {
            text-align: center;
            margin-top: 20px;
        }

        #resultImagePreview {
            max-width: 100%;
            height: auto;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            display: block; /* ç¢ºä¿åœ–ç‰‡ç¨ä½”ä¸€è¡Œä¸¦å±…ä¸­ */
            margin: 0 auto;
        }

        /* æ‰‹æ©Ÿæç¤ºæ–‡å­— */
        #saveImageHintText {
            font-size: 0.9em;
            color: #777;
            margin-top: 10px;
        }

        /* çµæœé çš„å…è²¬è²æ˜ */
        .disclaimer {
            margin-top: 30px; /* å¢åŠ èˆ‡æŒ‰éˆ•çš„è·é›¢ */
            font-size: 0.85em;
            color: #888;
            text-align: center;
        }

        /* æ›´å¤šè©³æƒ…é é¢æ¨£å¼ */
        #more-details-container {
            background-color: #fdfdfd;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        #more-details-container h2 {
            color: #3b4252;
            font-size: 2em;
            margin-bottom: 20px;
        }
        #more-details-container p {
            font-size: 1.1em;
            color: #4c566a;
            line-height: 1.8;
            margin-bottom: 30px;
        }
        #more-details-container .copy-link-group {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap; /* ç¢ºä¿åœ¨å°è¢å¹•ä¸Šæ›è¡Œ */
        }
        #more-details-container .copy-link-group input {
            flex-grow: 1;
            max-width: 300px;
            padding: 10px 15px;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 1em;
            text-align: center;
            background-color: #eceff4;
            color: #4c566a;
        }
        #more-details-container .copy-link-group button {
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 1em;
            background-color: #88c0d0;
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        #more-details-container .copy-link-group button:hover {
            background-color: #639db5;
        }


        /* æ‰‹æ©Ÿé©é… */
        @media (max-width: 768px) {
            body {
                padding: 10px; /* æ¸›å°‘æ•´é«” padding */
            }
            .container {
                padding: 20px 15px;
                border-radius: 10px;
            }
            .quiz-section h1,
            .quiz-section h2 {
                font-size: 1.8em; /* æ‰‹æ©Ÿä¸Šæ¨™é¡Œå­—é«”ç¸®å° */
            }
            .quiz-section .tagline, .food-description {
                font-size: 1em;
            }
            .question-text {
                font-size: 1.1em;
            }
            .option-btn {
                padding: 10px 15px;
                font-size: 0.95em;
            }
            .navigation-btns button {
                flex: 1; /* æ‰‹æ©Ÿä¸ŠæŒ‰éˆ•å¹³å‡åˆ†ä½ˆ */
                font-size: 1em;
            }
            .feedback-buttons {
                flex-direction: column; /* æ‰‹æ©Ÿä¸Šå›é¥‹æŒ‰éˆ•å‚ç›´æ’åˆ— */
                align-items: stretch;
            }
            .feedback-buttons button {
                width: 100%; /* æ‰‹æ©Ÿä¸ŠæŒ‰éˆ•ä½”æ»¿å¯¬åº¦ */
            }
            /* æ‰‹æ©Ÿä¸Šä¸‹è¼‰æŒ‰éˆ•å’Œé•·æŒ‰æç¤ºéƒ½é¡¯ç¤º */
            #downloadImageBtn {
                display: inline-block; /* ç¢ºä¿æŒ‰éˆ•é¡¯ç¤º */
            }
            #saveImageHintText {
                display: block; /* ç¢ºä¿æç¤ºé¡¯ç¤º */
            }
            /* æ‰‹æ©Ÿä¸Šå…¼å®¹æ€§å€å¡Šç¶­æŒä¸¦æ’ï¼Œä½†å¯èƒ½æœƒæ›è¡Œ */
            .compatibility-sections-wrapper {
                flex-direction: row; /* ä¿æŒæ©«æ’ */
                flex-wrap: wrap; /* å…è¨±æ›è¡Œ */
                justify-content: center; /* å¦‚æœæ›è¡Œï¼Œè®“å€å¡Šç½®ä¸­ */
            }
            .compatibility-section {
                min-width: 280px; /* èª¿æ•´æœ€å°å¯¬åº¦ï¼Œè®“æ‰‹æ©Ÿä¸Šä¹Ÿèƒ½ç›¡é‡ä¸¦æ’æˆ–å„ªé›…æ›è¡Œ */
                flex: 1 1 auto; /* å…è¨±ç¸®å°å’Œæ“´å¤§ */
            }
            .food-grid {
                grid-template-columns: 1fr; /* æ‰‹æ©Ÿä¸Šå–®æ¬„é¡¯ç¤ºé£Ÿç‰©å¡ç‰‡ */
            }
            #more-details-container .copy-link-group {
                flex-direction: column;
            }
            #more-details-container .copy-link-group input {
                max-width: 100%;
            }
        }

        /* é›»è…¦é©é… */
        @media (min-width: 769px) {
            /* é›»è…¦ä¸Šé¡¯ç¤ºä¸‹è¼‰æŒ‰éˆ•ï¼Œé•·æŒ‰æç¤ºä¹Ÿé¡¯ç¤º (å¦‚æœéœ€è¦) */
            #downloadImageBtn {
                display: inline-block; /* ç¢ºä¿æŒ‰éˆ•é¡¯ç¤º */
            }
            #saveImageHintText {
                display: block; /* ç¢ºä¿æç¤ºé¡¯ç¤º */
            }
            .compatibility-sections-wrapper {
                flex-direction: row; /* ä¿æŒæ©«æ’ */
                flex-wrap: wrap; /* å…è¨±æ›è¡Œ */
            }
            .compatibility-section {
                flex: 1; /* è®“æ¯å€‹å€å¡Šå¹³å‡åˆ†é…ç©ºé–“ */
                min-width: 300px; /* ç¢ºä¿è¶³å¤ å¯¬åº¦ */
            }
        }
        /* CSS æ¨£å¼çµæŸ */
    </style>
</head>
<body>
    <div class="container">
        <div id="intro-container" class="quiz-section">
            <h1>æ­¡è¿ä¾†åˆ°ã€Œé£Ÿç‰©äººæ ¼ã€æ¸¬é©—ï¼</h1>
            <p class="tagline">æ‰¾å‡ºä½ æ˜¯å“ªç¨®é¢¨å‘³çš„é£Ÿç‰©ï¼Œæ¢ç´¢ä½ çš„ç¨ç‰¹å€‹æ€§ï¼</p>
            <div class="user-name-input-group">
                <label for="userName">è«‹è¼¸å…¥ä½ çš„**å€‹æ€§åç¨±**ï¼š</label>
                <input type="text" id="userName" placeholder="ä¾‹å¦‚ï¼šæ–™ç†å°ç•¶å®¶ã€é£Ÿç¥" class="input-field">
            </div>
            <button id="startQuizBtn" class="primary-btn">é–‹å§‹æ¸¬é©—</button>
            <p class="disclaimer">
                å…è²¬è²æ˜ï¼šæœ¬æ¸¬é©—çµæœåƒ…ä¾›å¨›æ¨‚èˆ‡è‡ªæˆ‘æ¢ç´¢ï¼Œä¸æ‡‰è¢«è¦–ç‚ºå°ˆæ¥­å¿ƒç†åˆ†æã€‚
            </p>
        </div>

        <div id="quiz-container" class="quiz-section hidden">
            <div id="stage-progress" class="progress-indicator"></div>
            <div id="current-stage-content">
                </div>
            <div class="navigation-btns">
                <button id="prevStageBtn" class="nav-btn hidden" data-direction="prev">ä¸Šä¸€éšæ®µ</button>
                <button id="nextStageBtn" class="nav-btn" data-direction="next">ä¸‹ä¸€éšæ®µ</button>
            </div>
        </div>

        <div id="result-container" class="quiz-section hidden">
            <div id="screenshot-area" class="result-display-area">
                <h2 class="result-title">
                    <span id="userNameDisplay" class="username-highlight"></span>ï¼Œä½ çš„é¢¨å‘³äººæ ¼æ˜¯ï¼š
                </h2>
                <p id="final-food-personality" class="food-personality-name"></p>
                <p id="food-personality-description" class="food-description"></p>

                <div class="compatibility-sections-wrapper">
                    <div class="compatibility-section">
                        <h3>å’Œä½ æœ€åˆæ‹çš„é£Ÿç‰©ï¼š</h3> <div id="suitable-foods-grid" class="food-grid">
                            </div>
                    </div>

                    <div class="compatibility-section">
                        <h3>ä½ å¯èƒ½éœ€è¦å¤šé»ç†è§£çš„é£Ÿç‰©ï¼š</h3> <div id="unsuitable-foods-grid" class="food-grid">
                            </div>
                    </div>
                </div>

                <p class="disclaimer">
                    å…è²¬è²æ˜ï¼šæœ¬æ¸¬é©—çµæœåƒ…ä¾›å¨›æ¨‚èˆ‡è‡ªæˆ‘æ¢ç´¢ï¼Œä¸æ‡‰è¢«è¦–ç‚ºå°ˆæ¥­å¿ƒç†åˆ†æã€‚
                    <br>è«‹å‹¿å°‡æ­¤çµæœä½œç‚ºä»»ä½•æ­£å¼è©•æ–·çš„ä¾æ“šã€‚
                </p>
            </div>

            <div id="image-display-area">
                <img id="resultImagePreview" src="" alt="æˆ‘çš„é£Ÿç‰©äººæ ¼æ¸¬é©—çµæœ">
                <p id="saveImageHintText">æ‰‹æ©Ÿç”¨æˆ¶ï¼šé•·æŒ‰ä¸Šæ–¹åœ–ç‰‡å³å¯å„²å­˜çµæœ</p>
            </div>

            <div id="feedback-section" class="feedback-section">
                <h3>æ¸¬é©—çµæœæ˜¯å¦æº–ç¢ºï¼Ÿå›é¥‹çµæŸå¾Œèƒ½çœ‹æ›´å¤šåˆ†æå–”ï¼</h3>
                <div class="feedback-buttons">
                    <button data-feedback="accurate">å¾ˆæº–ï¼ğŸ‘</button>
                    <button data-feedback="somewhat">æœ‰é»æº– ğŸ¤”</button>
                    <button data-feedback="inaccurate">ä¸æº– ğŸ‘</button>
                </div>
            </div>

            <div class="result-actions">
                <a id="downloadImageBtn" class="secondary-btn" href="#" download="æˆ‘çš„é£Ÿç‰©äººæ ¼æ¸¬é©—çµæœ.png">ä¸‹è¼‰åœ–ç‰‡</a>
                <button id="viewMoreDetailsBtn" class="primary-btn hidden">æŸ¥çœ‹æ›´å¤šè©³æƒ…</button>
                <button id="restartQuizBtn" class="secondary-btn">é‡æ–°æ¸¬é©—</button>
            </div>
        </div>

        <div id="more-details-container" class="quiz-section hidden">
            <h2>æ­å–œä½ è¢«æ•´</h2>
            <p>
                é€™æ˜¯ä¸€ä»½å®Œå…¨éš¨æ©Ÿçš„å¿ƒç†æ¸¬é©— è¶•ç·Šåˆ†äº«çµ¦æœ‹å‹å§ è®“ä»–ä¹Ÿé«”é©—ä¸€ä¸‹å§ï¼
            </p>
            <div class="copy-link-group">
                <input type="text" id="shareLink" value="https://reurl.cc/W0g405" readonly>
                <button id="copyLinkBtn">è¤‡è£½é€£çµ</button>
            </div>
            <button id="restartQuizBtnFromDetails" class="secondary-btn">é‡æ–°æ¸¬é©—</button>
        </div>
    </div>

    <script>
        // JavaScript ä»£ç¢¼é–‹å§‹

        // DOM å…ƒç´ å¼•ç”¨
        const introContainer = document.getElementById('intro-container');
        const quizContainer = document.getElementById('quiz-container');
        const resultContainer = document.getElementById('result-container');
        const startQuizBtn = document.getElementById('startQuizBtn');
        const userNameInput = document.getElementById('userName');
        const currentStageContent = document.getElementById('current-stage-content');
        const prevStageBtn = document.getElementById('prevStageBtn');
        const nextStageBtn = document.getElementById('nextStageBtn');
        const finalFoodPersonalityElement = document.getElementById('final-food-personality');
        const foodPersonalityDescriptionElement = document.getElementById('food-personality-description');
        // å…¼å®¹æ€§é£Ÿç‰©ç¶²æ ¼çš„ DOM å¼•ç”¨
        const suitableFoodsGrid = document.getElementById('suitable-foods-grid');
        const unsuitableFoodsGrid = document.getElementById('unsuitable-foods-grid');

        const restartQuizBtn = document.getElementById('restartQuizBtn');
        const feedbackSection = document.getElementById('feedback-section');
        const feedbackButtons = document.querySelectorAll('#feedback-section .feedback-buttons button');
        const saveImageHintText = document.getElementById('saveImageHintText');
        const resultImagePreview = document.getElementById('resultImagePreview');
        const downloadImageBtn = document.getElementById('downloadImageBtn');
        const screenshotArea = document.getElementById('screenshot-area');

        const viewMoreDetailsBtn = document.getElementById('viewMoreDetailsBtn');
        const moreDetailsContainer = document.getElementById('more-details-container');
        const shareLinkInput = document.getElementById('shareLink');
        const copyLinkBtn = document.getElementById('copyLinkBtn');
        const restartQuizBtnFromDetails = document.getElementById('restartQuizBtnFromDetails');


        let currentStageIndex = 0;
        let userName = '';
        let userAnswers = {}; // {globalQuestionIndex: selectedOptionIndex}
        let mbtiScores = { E: 0, I: 0, S: 0, N: 0, T: 0, F: 0, J: 0, P: 0 };
        let enneagramScores = { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0, 7: 0, 8: 0, 9: 0 };

        // æ¸¬é©—æ•¸æ“š (MBTI å’Œä¹å‹äººæ ¼ç›¸é—œå•é¡Œ)
        const stages = [
            {
                intro: "âœ¨ **éšæ®µä¸€ï¼šåˆç™»å ´èˆ‡è‡ªæˆ‘é©æ‡‰** âœ¨<br>æ¢ç´¢ä½ åœ¨æ–°ç’°å¢ƒä¸‹çš„åˆå§‹åæ‡‰ã€‚",
                questions: [
                    {
                        question: "1. ä¸€è¦ºé†’ä¾†ï¼Œä½ ç™¼ç¾è‡ªå·±è®Šæˆäº†ä¸€å¡Šé£Ÿç‰©ï¼Œä½ çš„ç¬¬ä¸€åæ‡‰ï¼Ÿ",
                        options: [
                            { text: "å…ˆè§€å¯Ÿå‘¨åœç’°å¢ƒï¼Œä¸æ…Œä¸å¿™", scores: { mbti: { I: 2, S: 1, J: 1 }, enneagram: { 5: 2, 6: 1 } } },
                            { text: "ã€Œä¹Ÿå¤ªå¥½ç©äº†å§ï¼ã€ç«‹åˆ»æƒ³æ‹ vlog", scores: { mbti: { E: 2, N: 1, P: 1 }, enneagram: { 7: 2, 3: 1 } } },
                            { text: "é¦¬ä¸Šæ“¬å®šé€ƒè„«è¨ˆç•«", scores: { mbti: { I: 1, N: 2, T: 1, J: 1 }, enneagram: { 1: 2, 8: 1 } } },
                            { text: "æ·¡æ·¡åœ°æ¥å—å‘½é‹ï¼Œæ„Ÿå˜†äººç”Ÿå¤šè®Š", scores: { mbti: { I: 1, N: 1, F: 2, P: 1 }, enneagram: { 4: 2, 9: 1 } } }
                        ]
                    }
                    ,
                    {
                        question: "2. åœ¨é€™å€‹å…¨æ–°çš„é£Ÿç‰©ä¸–ç•Œï¼Œä½ éœ€è¦å‘ä¸€ç¾¤é™Œç”Ÿé£Ÿç‰©è‡ªæˆ‘ä»‹ç´¹ï¼Œä½ æœƒï¼Ÿ",
                        options: [
                            { text: "ç†±æƒ…é–‹å ´ï¼Œé‚„å¹«åˆ¥äººä»‹ç´¹", scores: { mbti: { E: 2, F: 1 }, enneagram: { 2: 2, 7: 1 } } },
                            { text: "ç°¡çŸ­è¬›å®Œå°±æƒ³å¿«é–ƒ", scores: { mbti: { I: 2, T: 1 }, enneagram: { 5: 2, 6: 1 } } },
                            { text: "è¬›å¾—å¾ˆå“²å­¸ï¼Œå¸Œæœ›æœ‰äººæ‡‚ä½ ", scores: { mbti: { I: 1, N: 1, F: 2 }, enneagram: { 4: 2, 9: 1 } } },
                            { text: "å·å·è§€å¯Ÿå…¶ä»–äººå¦‚ä½•åšå†è¡Œå‹•", scores: { mbti: { I: 2, S: 1, J: 1 }, enneagram: { 6: 2, 9: 1 } } }
                        ]
                    },
                    {
                        question: "3.ä½ æœ€å¸Œæœ›è‡ªå·±æˆç‚ºæ€æ¨£çš„é£Ÿç‰©ï¼Œæœƒè®“å¤§å®¶è¨˜ä½ä½ ï¼Ÿ",
                        options: [
                            { text: "æœ‰æ„›å¿ƒä¸”è¢«å¤§å®¶éœ€è¦", scores: { mbti: { E: 1, S: 1, F: 2, J: 1 }, enneagram: { 2: 2, 9: 1 } } },
                            { text: "å‹‡æ•¢ä¸”æˆå°±éå‡¡", scores: { mbti: { E: 1, N: 1, T: 2, J: 1 }, enneagram: { 8: 2, 3: 1 } } },
                            { text: "ç¨ç‰¹ä¸”å……æ»¿å‰µæ„", scores: { mbti: { I: 1, N: 2, F: 1, P: 1 }, enneagram: { 4: 2, 7: 1 } } },
                            { text: "å®‰ç©©å¯é ï¼Œå€¼å¾—ä¿¡è³´", scores: { mbti: { I: 1, S: 2, F: 1, J: 1 }, enneagram: { 6: 2, 1: 1 } } }
                        ]
                    },
                ]
            },
            {
                intro: "ğŸ¤ **éšæ®µäºŒï¼šåœ˜éšŠçµ„å»ºèˆ‡åˆæ¬¡æŒ‘æˆ°** ğŸ¤<br>è€ƒé©—ä½ çš„é ˜å°ã€å”ä½œèˆ‡æ‡‰è®Šèƒ½åŠ›ã€‚",
                questions: [
                    {
                        question: "4. é¢å°å³å°‡åˆ°ä¾†çš„åœ˜éšŠæŒ‘æˆ°ï¼Œä½ æœƒé¸æ“‡åœ¨éšŠä¼ä¸­æ‰®æ¼”ä»€éº¼è§’è‰²ï¼Ÿ",
                        options: [
                            { text: "éšŠä¼è£¡çš„åŠ©æ‰‹ï¼Œå”åŠ©å¤§å®¶", scores: { mbti: { E: 1, S: 1, F: 2, J: 1 }, enneagram: { 2: 2, 6: 1 } } },
                            { text: "é ˜å°è€…ï¼ŒæŒæ¡å…¨å±€", scores: { mbti: { E: 1, N: 1, T: 2, J: 1 }, enneagram: { 8: 2, 3: 1 } } },
                            { text: "è§€å¯Ÿè€…ï¼Œå†·éœåˆ†æ", scores: { mbti: { I: 2, N: 1, T: 1, P: 1 }, enneagram: { 5: 2, 1: 1 } } },
                            { text: "è‡ªç”±è¡Œå‹•è€…ï¼Œéˆæ´»æ‡‰è®Š", scores: { mbti: { E: 1, S: 2, P: 1 }, enneagram: { 7: 2, 8: 1 } } }
                        ]
                    },
                    {
                        question: "5. éšŠä¼ä¸­ï¼Œä½ è¢«é¸ç‚ºéšŠé•·ï¼Œè¦å¸¶é ˜å¤§å®¶å®Œæˆä¸€å€‹å›°é›£çš„æ–™ç†ä»»å‹™ï¼Œä½ æœƒï¼Ÿ",
                        options: [
                            { text: "å…¬é–‹è¡¨æ±ºï¼Œå¤§å®¶èªªäº†ç®—", scores: { mbti: { I: 1, S: 1, F: 2, J: 1 }, enneagram: { 9: 2, 2: 1 } } },
                            { text: "è¦ªè‡ªè¦åŠƒæˆ°è¡“èˆ‡åˆ†å·¥", scores: { mbti: { E: 1, N: 1, T: 2, J: 1 }, enneagram: { 8: 2, 1: 1 } } },
                            { text: "é»˜é»˜å®Œæˆæœ€å¤šäº‹æƒ…ä½†ä¸çˆ­åŠŸ", scores: { mbti: { I: 1, S: 2, T: 1, P: 1 }, enneagram: { 6: 2, 5: 1 } } },
                            { text: "ç”¨æ•…äº‹é¼“èˆå¤§å®¶çš„å¿ƒ", scores: { mbti: { E: 1, N: 1, F: 2, J: 1 }, enneagram: { 2: 2, 7: 1 } } }
                        ]
                    },
                    {
                        question: "6. è©•å¯©èªªä½ å¾ˆåƒã€Œç”œé»ç³»ã€é£Ÿç‰©ï¼Œé€™æœƒå½±éŸ¿ä½ çš„éšŠä¼åˆ†å·¥ï¼Œä½ æ€éº¼å›æ‡‰ï¼Ÿ",
                        options: [
                            { text: "ã€Œè¬è¬èª‡çï¼Œæˆ‘ä¹Ÿè¦ºå¾—æˆ‘å¾ˆé¦™ï¼ã€", scores: { mbti: { E: 2, S: 1, F: 1, P: 1 }, enneagram: { 3: 2, 7: 1 } } },
                            { text: "ã€Œæˆ‘å…¶å¯¦æ˜¯é¹¹çš„ï¼Œåˆ¥èª¤æœƒæˆ‘äº†ã€", scores: { mbti: { I: 1, S: 2, T: 1, J: 1 }, enneagram: { 1: 2, 8: 1 } } },
                            { text: "ã€Œä½ è¦ºå¾—åƒç”œçš„ï¼Œæ˜¯å› ç‚ºä½ ä¸æ‡‚æˆ‘ã€‚ã€", scores: { mbti: { I: 1, N: 1, F: 2, P: 1 }, enneagram: { 4: 2, 9: 1 } } },
                            { text: "ã€Œé‚£æˆ‘å°±ä¾†ç™¼æ®ç”œé»çš„æœ€å¤§åƒ¹å€¼ï¼ã€", scores: { mbti: { E: 1, N: 1, T: 2, J: 1 }, enneagram: { 8: 2, 3: 1 } } }
                        ]
                    },
                    {
                        question: "7. æ¯”è³½ä¸­é‡åˆ°ä¸€å€‹é—œéµé¸æ“‡ï¼Œä½ çš„éšŠä¼éœ€è¦æ±ºå®šä¸‹ä¸€æ­¥ç­–ç•¥ï¼Œä½ é€šå¸¸æ€éº¼åšï¼Ÿ",
                        options: [
                            { text: "åˆ†æåˆ©å¼Šå†æ±ºå®š", scores: { mbti: { I: 1, N: 2, T: 1, J: 1 }, enneagram: { 1: 2, 5: 1 } } },
                            { text: "è½å¾ç›´è¦ºèˆ‡æƒ…ç·’", scores: { mbti: { I: 1, N: 1, F: 2, P: 1 }, enneagram: { 4: 2, 7: 1 } } },
                            { text: "å•æœ‹å‹å¤§å®¶æ„è¦‹å¦‚ä½•", scores: { mbti: { E: 1, S: 1, F: 2, J: 1 }, enneagram: { 6: 2, 9: 1 } } },
                            { text: "å…ˆè¡å†èªªï¼Œä¹‹å¾Œå†èª¿æ•´", scores: { mbti: { E: 1, S: 2, P: 1 }, enneagram: { 7: 2, 8: 1 } } }
                        ]
                    },
                    {
                        question: "8.ã€Œé£Ÿç‰©ç•Œå¤§æˆ°ã€çš„è™Ÿè§’å³å°‡å¹éŸ¿ï¼Œä½ å€‘éšŠä¼æº–å‚™æ€éº¼æ‡‰å°é€™å ´æ±ºè³½ï¼Ÿ",
                        options: [
                            { text: "ä»”ç´°è¨ˆç•«èˆ‡æº–å‚™", scores: { mbti: { I: 2, S: 1, J: 1 }, enneagram: { 1: 2, 5: 1 } } },
                            { text: "éš¨é‡è€Œå®‰ï¼Œé©æ‡‰ç’°å¢ƒ", scores: { mbti: { I: 1, S: 2, P: 1 }, enneagram: { 6: 2, 9: 1 } } },
                            { text: "çµ„ç¹”åœ˜éšŠï¼Œç™¼æ®åˆä½œ", scores: { mbti: { E: 2, N: 1, F: 1, J: 1 }, enneagram: { 2: 2, 6: 1 } } },
                            { text: "è¡é‹’é™·é™£ï¼Œå‹‡å¾€ç›´å‰", scores: { mbti: { E: 1, S: 2, P: 1 }, enneagram: { 8: 2, 7: 1 } } }
                        ]
                    },
                ]
            },
            {
                intro: "ğŸ§  **éšæ®µä¸‰ï¼šè³½ä¸­çªç™¼ç‹€æ³èˆ‡äººéš›è™•ç†** ğŸ§ <br>ä½ çš„åæ‡‰å’Œè™•ç†æ–¹å¼å°‡æ±ºå®šä½ çš„é£Ÿç‰©äººæ ¼èµ°å‘ã€‚",
                questions: [
                    {
                        question: "9. æ¯”è³½æœŸé–“ï¼Œä½ ç™¼ç¾æœ‰æ•µéšŠçš„é£Ÿç‰©ä½œå¼Šï¼Œä½†ä»–å€‘æˆç¸¾æ–ç„¶ï¼Œä½ æœƒï¼Ÿ",
                        options: [
                            { text: "éŒ„å½±æª¢èˆ‰ï¼Œå…¬å¹³æœ€é‡è¦", scores: { mbti: { I: 1, S: 1, T: 2, J: 1 }, enneagram: { 1: 2, 8: 1 } } },
                            { text: "ç§ä¸‹æ‰¾ä»–è«‡è«‡ï¼Œå‹¸ä»–å¦ç™½", scores: { mbti: { I: 1, N: 1, F: 2, J: 1 }, enneagram: { 2: 2, 6: 1 } } },
                            { text: "é»˜é»˜è¨˜ä¸‹ä¾†ï¼Œä½†ä¸å‡ºè²", scores: { mbti: { I: 2, N: 1, T: 1, P: 1 }, enneagram: { 5: 2, 9: 1 } } },
                            { text: "æƒ³èªªé€™åªæ˜¯éŠæˆ²ï¼Œä½•å¿…è¼ƒçœŸ", scores: { mbti: { E: 1, S: 2, F: 1, P: 1 }, enneagram: { 7: 2, 3: 1 } } }
                        ]
                    },
                    {
                        question: "10. è©•å¯©çªç„¶è¦æ±‚ä½ é€²è¡Œä¸€å ´å³èˆˆçš„ã€Œé£Ÿææ­é…è¡¨æ¼”ã€ï¼Œä½ æœƒï¼Ÿ",
                        options: [
                            { text: "å¤§è†½è¡¨æ¼”ï¼Œæˆç‚ºç„¦é»", scores: { mbti: { E: 2, S: 1, P: 1 }, enneagram: { 3: 2, 7: 1 } } },
                            { text: "è¬¹æ…æº–å‚™ï¼Œæ±‚å®Œç¾", scores: { mbti: { I: 1, S: 1, T: 2, J: 1 }, enneagram: { 1: 2, 5: 1 } } },
                            { text: "ç™¼æ®å‰µæ„ï¼Œç©å‡ºæ–°èŠ±æ¨£", scores: { mbti: { E: 1, N: 2, P: 1 }, enneagram: { 7: 2, 4: 1 } } },
                            { text: "ä¿æŒå†·éœï¼Œç©©ç©©å®Œæˆ", scores: { mbti: { I: 1, S: 2, J: 1 }, enneagram: { 6: 2, 9: 1 } } }
                        ]
                    },
                    {
                        question: "11.ä½ çš„éšŠå‹ã€Œç»ç’ƒå¿ƒèµ·å¸é‹ã€å› ç‚ºè¡¨ç¾ä¸ä½³è€Œæƒ…ç·’å´©æ½°ï¼Œä½ æœƒï¼Ÿ",
                        options: [
                            { text: "è®“ä»–å“­ä¸€å“­å†æŠ±æŠ±", scores: { mbti: { I: 1, S: 1, F: 2, P: 1 }, enneagram: { 2: 2, 9: 1 } } },
                            { text: "ç›´æ¥å‘Šè¨´ä»–ã€Œä½ è¦å …å¼·ä¸€é»ï¼ã€", scores: { mbti: { E: 1, S: 2, T: 1, J: 1 }, enneagram: { 1: 2, 8: 1 } } },
                            { text: "è«‹åˆ¥äººå¹«æˆ‘è™•ç†ï¼Œæˆ‘ä¸æƒ³è¢«æƒ…ç·’å‹’ç´¢", scores: { mbti: { I: 2, N: 1, T: 1, P: 1 }, enneagram: { 5: 2, 4: 1 } } },
                            { text: "é™ªä»–ç•«ç•«èŠèŠå¤©ï¼Œè½‰ç§»æƒ…ç·’", scores: { mbti: { E: 1, N: 1, F: 2, P: 1 }, enneagram: { 4: 2, 7: 1 } } }
                        ]
                    },
                    {
                        question: "12. æœ‰åŒéšŠçš„é£Ÿç‰©æ¶èµ°äº†ä½ ç²¾å¿ƒæº–å‚™çš„ã€Œå‰µæ„é»å­ã€çš„åŠŸå‹ï¼Œä½ æœƒï¼Ÿ",
                        options: [
                            { text: "ç›´æ¥å°è³ªï¼Œç¶­è­·è‡ªå·±çš„æ¬Šç›Š", scores: { mbti: { E: 1, S: 1, T: 2, J: 1 }, enneagram: { 8: 2, 1: 1 } } },
                            { text: "å¿ƒè£¡ä¸æ»¿ï¼Œä½†é¸æ“‡å¿è€", scores: { mbti: { I: 1, S: 1, F: 2, P: 1 }, enneagram: { 9: 2, 6: 1 } } },
                            { text: "è©¦è‘—è½‰ç§»æ³¨æ„åŠ›ï¼Œé¿å…è¡çª", scores: { mbti: { E: 1, N: 1, F: 2, P: 1 }, enneagram: { 2: 2, 7: 1 } } },
                            { text: "æš—è‡ªåŠªåŠ›è­‰æ˜è‡ªå·±æ›´å¼·", scores: { mbti: { I: 1, N: 1, T: 2, J: 1 }, enneagram: { 1: 2, 3: 1 } } }
                        ]
                    },
                    {
                        question: "13. ä½ çš„éšŠå‹åœ¨æŸå€‹ç’°ç¯€ä¸å¹¸è¢«æ·˜æ±°äº†ï¼Œä½ æœƒï¼Ÿ",
                        options: [
                            { text: "ç«‹åˆ»å®‰æ…°ä¸¦å¹«å¿™", scores: { mbti: { E: 1, N: 1, F: 2, J: 1 }, enneagram: { 2: 2, 6: 1 } } },
                            { text: "é»˜é»˜æ„Ÿåˆ°é›£éï¼Œè‡ªå·±ä¹Ÿé™·å…¥ä½æ½®", scores: { mbti: { I: 1, N: 1, F: 2, P: 1 }, enneagram: { 4: 2, 9: 1 } } },
                            { text: "è¿…é€Ÿèª¿æ•´ç­–ç•¥ï¼Œç¹¼çºŒå‰é€²", scores: { mbti: { I: 1, N: 1, T: 2, J: 1 }, enneagram: { 8: 2, 3: 1 } } },
                            { text: "è¦ºå¾—æ˜¯è‡ªç„¶æ·˜æ±°ï¼Œæ²’ä»€éº¼å¤§ä¸äº†", scores: { mbti: { I: 1, S: 2, T: 1, P: 1 }, enneagram: { 5: 2, 1: 1 } } }
                        ]
                    },
                    {
                        question: "14. ä½ ç™¼ç¾ä½ æš—æˆ€çš„ã€Œç±³å…¶æ—ä¸»å»šã€æ˜¯æ•µéšŠçš„é—œéµäººç‰©â€¦ï¼Ÿ",
                        options: [
                            { text: "æƒ³è¾¦æ³•å’Œä»–ç§ä¸‹è¯çµ¡", scores: { mbti: { E: 1, N: 2, F: 1, P: 1 }, enneagram: { 7: 2, 2: 1 } } },
                            { text: "éš±è—æƒ…æ„Ÿï¼Œå°ˆæ³¨æ¯”è³½", scores: { mbti: { I: 2, S: 1, T: 1, J: 1 }, enneagram: { 1: 2, 5: 1 } } },
                            { text: "è‹¦æƒ±åˆçŸ›ç›¾ï¼Œå¿ƒæƒ…è¤‡é›œ", scores: { mbti: { I: 1, N: 1, F: 2, P: 1 }, enneagram: { 4: 2, 6: 1 } } },
                            { text: "è¦ºå¾—é€™æ˜¯æœ‰è¶£çš„æŒ‘æˆ°", scores: { mbti: { E: 1, S: 2, P: 1 }, enneagram: { 8: 2, 7: 1 } } }
                        ]
                    },
                ]
            },
            {
                intro: "ğŸ”¥ **éšæ®µå››ï¼šå£“åŠ›èˆ‡è‡ªçœ** ğŸ”¥<br>æ¢ç´¢ä½ å¦‚ä½•åœ¨å£“åŠ›ä¸‹è‡ªæˆ‘åæ€ï¼Œä»¥åŠä½ æœ€çè¦–çš„åƒ¹å€¼ã€‚",
                questions: [
                    {
                        question: "15. æ¯”è³½é€²å…¥æœ€çµ‚è¡åˆºï¼Œä½ çªç„¶é‡åˆ°ä¸€å€‹é æ–™ä¹‹å¤–çš„ã€Œé£Ÿæè®Šè³ªã€å±æ©Ÿï¼Œä½ çš„åæ‡‰æ˜¯ï¼Ÿ",
                        options: [
                            { text: "ç«‹åˆ»æƒ³è¾¦æ³•æ‡‰å°ä¸¦å¹«åŠ©ä»–äºº", scores: { mbti: { E: 1, N: 1, F: 2, J: 1 }, enneagram: { 6: 2, 2: 1 } } },
                            { text: "èº²èµ·ä¾†æ€è€ƒå“ªè£¡æœ€å®‰å…¨", scores: { mbti: { I: 2, N: 1, T: 1, P: 1 }, enneagram: { 5: 2, 9: 1 } } },
                            { text: "ã€Œé€™å¯èƒ½æ˜¯å‘½é‹çš„è€ƒé©—â€¦ã€é–‹å§‹è‡ªçœ", scores: { mbti: { I: 1, N: 1, F: 2, P: 1 }, enneagram: { 4: 2, 1: 1 } } },
                            { text: "ã€Œç‡ƒç‡’å§ï¼æˆ‘å°±æ˜¯ç«ç„°ï¼ã€ï¼ˆå‹‡æ•¢é¢å°å±æ©Ÿï¼‰", scores: { mbti: { E: 1, S: 2, P: 1 }, enneagram: { 8: 2, 7: 1 } } }
                        ]
                    },{
                        question: "16. æ¯”è³½é–“éš™çš„çŸ­æš«ä¼‘æ¯æ™‚é–“ï¼Œä½ æœƒå¦‚ä½•åˆ©ç”¨ä¾†ã€Œå……é›»ã€ï¼Ÿ",
                        options: [
                            { text: "ç¨è‡ªæ²‰æ€ï¼Œå……é›»ä¼‘æ¯", scores: { mbti: { I: 2, N: 1, T: 1, J: 1 }, enneagram: { 5: 2, 1: 1 } } },
                            { text: "ç†±é¬§ç¤¾äº¤ï¼Œèªè­˜æ–°æœ‹å‹", scores: { mbti: { E: 2, S: 1, P: 1 }, enneagram: { 7: 2, 3: 1 } } },
                            { text: "å’Œç†Ÿæ‚‰çš„äººèŠèŠå¤©", scores: { mbti: { I: 1, S: 1, F: 2, J: 1 }, enneagram: { 9: 2, 6: 1 } } },
                            { text: "åšé»å–œæ­¡çš„å°äº‹æƒ…æ”¾é¬†", scores: { mbti: { I: 1, S: 1, F: 2, P: 1 }, enneagram: { 4: 2, 5: 1 } } }
                        ]
                    },
                    {
                        question: "17. åœ¨é€™å ´é£Ÿç‰©ç”Ÿå­˜å¤§è³½ä¸­ï¼Œä½ æœ€å®³æ€•å¤±å»ä»€éº¼ï¼Ÿ",
                        options: [
                            { text: "è¢«å¿½è¦–èˆ‡éºå¿˜", scores: { mbti: { I: 1, N: 1, F: 2, P: 1 }, enneagram: { 4: 2, 2: 1 } } },
                            { text: "å¤±æ§å’Œæ··äº‚", scores: { mbti: { E: 1, S: 1, T: 2, P: 1 }, enneagram: { 8: 2, 1: 1 } } },
                            { text: "ç„¡ç”¨èˆ‡è¢«æ‹’çµ•", scores: { mbti: { I: 1, S: 1, T: 2, J: 1 }, enneagram: { 1: 2, 3: 1 } } },
                            { text: "å­¤ç¨èˆ‡è¢«æ’æ–¥", scores: { mbti: { I: 1, S: 1, F: 2, J: 1 }, enneagram: { 6: 2, 9: 1 } } }
                        ]
                    },
                    {
                        question: "18. åœ¨ä¸€å ´æ¿€çƒˆçš„ã€Œé£Ÿç‰©ç†å¿µè¾¯è«–ã€ä¸­ï¼Œè©•å¯©å•ä½ ï¼šã€Œä½ ä½œç‚ºé£Ÿç‰©ï¼Œä½ å­˜åœ¨çš„æ„ç¾©æ˜¯ï¼Ÿã€ä½ èªªï¼Ÿ",
                        options: [
                            { text: "ã€Œç‚ºäº†è®“åˆ¥äººé–‹å¿ƒã€è¢«å–œæ­¡ï¼ã€", scores: { mbti: { E: 1, N: 1, F: 2, P: 1 }, enneagram: { 2: 2, 7: 1 } } },
                            { text: "ã€Œç‚ºäº†å®Œæˆä½¿å‘½ï¼ŒæŒ‘æˆ°æ¥µé™ã€‚ã€", scores: { mbti: { I: 1, N: 1, T: 2, J: 1 }, enneagram: { 8: 2, 3: 1 } } },
                            { text: "ã€Œæ²’æœ‰æ„ç¾©ï¼Œä½†æˆ‘æœƒè‡ªå·±å‰µé€ ã€‚ã€", scores: { mbti: { I: 1, N: 2, F: 1, P: 1 }, enneagram: { 4: 2, 5: 1 } } },
                            { text: "æˆ‘æ˜¯æä¾›è§£æ±ºæ–¹æ¡ˆçš„é‚£å€‹äººã€‚ã€", scores: { mbti: { I: 1, S: 1, T: 2, J: 1 }, enneagram: { 5: 2, 1: 1 } } }
                        ]
                    },
                ]
            },
            {
                intro: "ğŸ† **éšæ®µäº”ï¼šæ±ºè³½èˆ‡æœ€çµ‚å®šè«–** ğŸ†<br>ä½ çš„é¸æ“‡å°‡å¼•å°ä½ æ­ç¤ºä½ çš„çµ‚æ¥µé£Ÿç‰©äººæ ¼ã€‚",
                questions: [
                    {
                        question: "19. ç¶“éé€™å ´é¢¨å‘³å¤§æˆ°çš„æ´—ç¦®ï¼Œå¦‚æœå¯ä»¥é¸æ“‡ã€Œé¢¨å‘³é‡ç”Ÿã€ï¼Œä½ æœƒé¸æ“‡æˆç‚ºæ€æ¨£çš„é£Ÿç‰©ï¼Ÿ",
                        options: [
                            { text: "æ²’äººèªå¾—æˆ‘ï¼Œæˆ‘å¯ä»¥é‡æ–°å®šç¾©è‡ªå·±", scores: { mbti: { I: 1, N: 2, F: 1, P: 1 }, enneagram: { 4: 2, 7: 1 } } },
                            { text: "åŠŸèƒ½å¼·å¤§ã€å—äººå€šè³´çš„è§’è‰²", scores: { mbti: { E: 1, S: 1, T: 2, J: 1 }, enneagram: { 3: 2, 8: 1 } } },
                            { text: "å¯æ„›åˆæœ‰äººä¿è­·æˆ‘", scores: { mbti: { I: 1, S: 1, F: 2, P: 1 }, enneagram: { 6: 2, 2: 1 } } },
                            { text: "è·Ÿç¾åœ¨ä¸€æ¨£ï¼Œæˆ‘è¦ºå¾—æˆ‘ä¸éŒ¯", scores: { mbti: { I: 1, S: 2, F: 1, J: 1 }, enneagram: { 9: 2, 1: 1 } } }
                        ]
                    },
                    {
                        question: "20. æœ€çµ‚è©•å¯©å°ä½ é€²è¡Œäº†å®šç¾©ï¼Œå®£å¸ƒä½ å±¬æ–¼æŸç¨®ã€Œé£Ÿç‰©äººæ ¼ã€ã€‚ä½ çš„åæ‡‰æ˜¯ï¼Ÿ",
                        options: [
                            { text: "æ¥å—é€™å€‹å®šç¾©ï¼ŒåŠªåŠ›åšå¥½è‡ªå·±", scores: { mbti: { I: 1, S: 2, F: 1, J: 1 }, enneagram: { 9: 2, 6: 1 } } },
                            { text: "æŒ‘æˆ°è©•å¯©ï¼Œè­‰æ˜è‡ªå·±ä¸åŒ", scores: { mbti: { I: 1, N: 1, T: 2, J: 1 }, enneagram: { 8: 2, 1: 1 } } },
                            { text: "é‡æ–°å®šç¾©è‡ªå·±ï¼Œé–‹å‰µæ–°è·¯", scores: { mbti: { I: 1, N: 2, F: 1, P: 1 }, enneagram: { 4: 2, 7: 1 } } },
                            { text: "ç¬‘çœ‹çµæœï¼Œéš¨ç·£è‡ªåœ¨", scores: { mbti: { E: 1, N: 2, F: 1, P: 1 }, enneagram: { 7: 2, 9: 1 } } }
                        ]
                    }
                ]
            }
        ];

        // é£Ÿç‰©äººæ ¼å®šç¾©
        const foodPersonalities = {
            macaron: {
                name: 'é¦¬å¡é¾',
                emoji: 'ğŸ¬',
                description: 'ä½ åƒé¦¬å¡é¾ä¸€æ¨£ï¼Œå……æ»¿äº†ç¹½ç´›çš„æƒ³åƒåŠ›èˆ‡å°ä¸–ç•Œçš„å¥½å¥‡å¿ƒã€‚ä½ ç†±æƒ…ã€æ¨‚è§€ï¼Œä¸¦ä¸”å–„æ–¼è¡¨é”æƒ…æ„Ÿï¼Œç¸½èƒ½ç‚ºå‘¨é­å¸¶ä¾†æ­¡æ¨‚èˆ‡æ´»åŠ›ã€‚'
            },
            tofuPudding: {
                name: 'è±†èŠ±',
                emoji: 'ğŸ®',
                description: 'ä½ åƒè±†èŠ±ä¸€æ¨£æº«æ½¤è€Œå¹³æ˜“è¿‘äººï¼Œæ“æœ‰ä¸€é¡†æŸ”è»Ÿä¸”å¯Œæœ‰åŒç†å¿ƒçš„å¿ƒã€‚ä½ æ¨‚æ–¼åŠ©äººï¼Œå–„æ–¼å‚¾è½ï¼Œæ˜¯æœ‹å‹å’Œå®¶äººå¿ƒä¸­æœ€æº«æš–çš„æ¸¯ç£ã€‚'
            },
            grilledCheeseSandwich: {
                name: 'ç†±å£“åå¸',
                emoji: 'ğŸ¥ª',
                description: 'ä½ åƒç†±å£“åå¸ä¸€æ¨£ï¼Œå¤–è¡¨é…¥è„†ï¼Œå…§å¿ƒæŸ”è»Ÿè€Œå……å¯¦ã€‚ä½ å‹™å¯¦ã€å¯é ï¼Œç¸½èƒ½çµ¦äººå¸¶ä¾†å®‰å…¨æ„Ÿï¼Œä¸¦ä¸”åœ¨é—œéµæ™‚åˆ»å±•ç¾å‡ºä½ çš„éŸŒæ€§ã€‚'
            },
            blackCoffee: {
                name: 'é»‘å’–å•¡',
                emoji: 'â˜•',
                description: 'ä½ åƒé»‘å’–å•¡ä¸€æ¨£ï¼Œæ²‰ç©©ã€ç†æ€§ï¼Œå…·æœ‰æ·±åº¦ã€‚ä½ å–œæ­¡ç¨ç«‹æ€è€ƒï¼Œè¿½æ±‚äº‹ç‰©çš„æœ¬è³ªï¼Œä¸¦ä¸”åœ¨é¢å°æŒ‘æˆ°æ™‚å±•ç¾å‡ºå …å®šçš„æ„å¿—ã€‚'
            },
            popcorn: {
                name: 'çˆ†ç±³èŠ±',
                emoji: 'ğŸ¿',
                description: 'ä½ åƒçˆ†ç±³èŠ±ä¸€æ¨£ï¼Œå……æ»¿äº†æ´»åŠ›èˆ‡é©šå–œã€‚ä½ ç†±æ„›è‡ªç”±ï¼Œå–œæ­¡å˜—è©¦æ–°äº‹ç‰©ï¼Œä¸¦ä¸”ç¸½èƒ½ç”¨ä½ çš„ç†±æƒ…æ„ŸæŸ“å‘¨é­çš„äººã€‚'
            },
            cottonCandy: {
                name: 'æ£‰èŠ±ç³–',
                emoji: 'â˜ï¸',
                description: 'ä½ åƒæ£‰èŠ±ç³–ä¸€æ¨£ï¼Œè¼•ç›ˆã€æŸ”è»Ÿï¼Œå……æ»¿äº†å¤¢å¹»ã€‚ä½ æ•æ„Ÿã€å¯Œæœ‰æƒ³åƒåŠ›ï¼Œä¸¦ä¸”æ“æœ‰ä¸€é¡†ç´”çœŸå–„è‰¯çš„å¿ƒï¼Œç¸½èƒ½ç‚ºä¸–ç•Œå¸¶ä¾†ä¸€çµ²ç”œèœœã€‚'
            },
            zucchini: {
                name: 'æ«›ç“œ',
                emoji: 'ğŸ¥’',
                description: 'ä½ åƒæ«›ç“œä¸€æ¨£ï¼Œæ¸…æ–°ã€è‡ªç„¶ï¼Œå…§æ–‚è€Œæœ‰æ·±åº¦ã€‚ä½ å†·éœã€ç†æ€§ï¼Œå–„æ–¼åˆ†æï¼Œä¸¦ä¸”ç¸½èƒ½ä¿æŒå®¢è§€çš„æ…‹åº¦çœ‹å¾…äº‹ç‰©ã€‚'
            },
            cheeseFondue: {
                name: 'èµ·å¸é‹',
                emoji: 'ğŸ«•',
                description: 'ä½ åƒèµ·å¸é‹ä¸€æ¨£ï¼Œæ¿ƒéƒã€ç†±æƒ…ï¼Œå……æ»¿äº†æ„ŸæŸ“åŠ›ã€‚ä½ æœæ–·ã€æœ‰è¡Œå‹•åŠ›ï¼Œä¸¦ä¸”ç¸½èƒ½å¸¶é ˜åœ˜éšŠé‚å‘æˆåŠŸã€‚'
            },
            roastedSweetPotato: {
                name: 'çƒ¤åœ°ç“œ',
                emoji: 'ğŸ ',
                description: 'ä½ åƒçƒ¤åœ°ç“œä¸€æ¨£ï¼Œæº«æš–ã€è¸å¯¦ï¼Œçµ¦äººä¸€ç¨®å®‰å¿ƒçš„æ„Ÿè¦ºã€‚ä½ å…§æ–‚ã€çœŸèª ï¼Œä¸¦ä¸”æ“æœ‰å …éŸŒçš„ç”Ÿå‘½åŠ›ï¼Œç¸½èƒ½é»˜é»˜åœ°æ”¯æŒèº«é‚Šçš„äººã€‚'
            }
        };

        // éš¨æ©Ÿç†ç”±åˆ—è¡¨ (é€™äº›æ–‡å­—å°‡ä¸å†é¡¯ç¤ºåœ¨å¡ç‰‡ä¸Šï¼Œä½†ä¿ç•™åœ¨ç¨‹å¼ç¢¼ä¸­ä»¥é˜²æœªä¾†éœ€è¦)
        const suitableReasons = [
            "å› ç‚ºä½ å€‘éƒ½å–œæ­¡åœ¨é€±æœ«è¼•é¬†èšæœƒã€‚",
            "ä½ å€‘ç¸½èƒ½ç†è§£å½¼æ­¤çš„å¹½é»˜æ„Ÿã€‚",
            "åœ¨å›°é›£æ™‚ï¼Œä½ å€‘æœƒäº’ç›¸æ”¯æŒã€‚",
            "ä½ å€‘å°ä¸–ç•Œå……æ»¿å¥½å¥‡ï¼Œå–œæ­¡ä¸€èµ·æ¢ç´¢æ–°äº‹ç‰©ã€‚",
            "ä½ å€‘åœ¨ä¸€èµ·æ™‚ï¼Œç¸½èƒ½æ‰¾åˆ°å¹³éœå’Œæ»¿è¶³ã€‚"
        ];

        const unsuitableReasons = [
            "ä»–å€‘çš„æ­¥èª¿å¯èƒ½èˆ‡ä½ ä¸å¤ªä¸€è‡´ã€‚",
            "ä½ å€‘å°äº‹ç‰©çš„çœ‹æ³•å¯èƒ½å­˜åœ¨è¼ƒå¤§å·®ç•°ã€‚",
            "åœ¨æŸäº›æƒ…æ³ä¸‹ï¼Œä½ å€‘çš„æºé€šæ–¹å¼å¯èƒ½éœ€è¦ç£¨åˆã€‚",
            "ä»–å€‘å–œæ­¡çš„æ´»å‹•æˆ–è¨±ä¸æ˜¯ä½ çš„èœã€‚",
            "ä½ å€‘åœ¨é¢å°å£“åŠ›æ™‚ï¼Œåæ‡‰æ–¹å¼å¯èƒ½æˆªç„¶ä¸åŒã€‚"
        ];

        // è¼”åŠ©å‡½æ•¸ï¼šç²å–å•é¡Œåœ¨æ‰€æœ‰éšæ®µä¸­çš„å…¨å±€ç´¢å¼•
        function getQuestionGlobalIndex(stageIndex, questionIndexInStage) {
            let globalIndex = 0;
            for (let i = 0; i < stageIndex; i++) {
                globalIndex += stages[i].questions.length;
            }
            return globalIndex + questionIndexInStage;
        }

        // æ¸²æŸ“ç•¶å‰éšæ®µçš„å•é¡Œ
        function renderStage() {
            const currentStage = stages[currentStageIndex];
            currentStageContent.innerHTML = '';

            // æ›´æ–°é€²åº¦æŒ‡ç¤ºå™¨
            const progressIndicator = document.getElementById('stage-progress');
            progressIndicator.innerText = `éšæ®µ ${currentStageIndex + 1} / ${stages.length}`; // é¡¯ç¤ºéšæ®µé€²åº¦

            // æ·»åŠ éšæ®µå¼•æ–‡
            if (currentStage.intro) {
                const introDiv = document.createElement('div');
                introDiv.className = 'stage-intro';
                introDiv.innerHTML = `<p>${currentStage.intro}</p>`;
                currentStageContent.appendChild(introDiv);
            }

            // æ¸²æŸ“å•é¡Œ
            currentStage.questions.forEach((q, qIndex) => {
                const questionBlock = document.createElement('div');
                questionBlock.className = 'question-block';
                const questionText = document.createElement('p');
                questionText.className = 'question-text';
                questionText.innerText = q.question;
                questionBlock.appendChild(questionText);

                const optionsContainer = document.createElement('div');
                optionsContainer.className = 'options-container';

                q.options.forEach((option, optionIndex) => {
                    const optionBtn = document.createElement('button');
                    optionBtn.className = 'option-btn';
                    optionBtn.innerText = option.text;
                    optionBtn.dataset.questionIndexInStage = qIndex;
                    optionBtn.dataset.optionIndex = optionIndex;

                    const globalQuestionIndex = getQuestionGlobalIndex(currentStageIndex, qIndex);
                    if (userAnswers[globalQuestionIndex] === optionIndex) {
                        optionBtn.classList.add('selected');
                    }

                    optionBtn.addEventListener('click', selectOption);
                    optionsContainer.appendChild(optionBtn);
                });
                questionBlock.appendChild(optionsContainer);
                currentStageContent.appendChild(questionBlock);
            });

            updateNavigationButtons();
            window.scrollTo(0, 0); // æ»¾å‹•åˆ°é é¢é ‚éƒ¨
        }

        // è™•ç†é¸é …é¸æ“‡
        function selectOption(event) {
            const selectedBtn = event.target;
            const questionIndexInStage = parseInt(selectedBtn.dataset.questionIndexInStage);
            const optionIndex = parseInt(selectedBtn.dataset.optionIndex);
            const globalQuestionIndex = getQuestionGlobalIndex(currentStageIndex, questionIndexInStage);

            // ç§»é™¤åŒå•é¡Œå…¶ä»–é¸é …çš„ selected ç‹€æ…‹
            const options = selectedBtn.closest('.options-container').querySelectorAll('.option-btn');
            options.forEach(btn => btn.classList.remove('selected'));

            // æ·»åŠ ç•¶å‰é¸é …çš„ selected ç‹€æ…‹
            selectedBtn.classList.add('selected');

            // å„²å­˜ç”¨æˆ¶ç­”æ¡ˆ
            userAnswers[globalQuestionIndex] = optionIndex;

            updateNavigationButtons(); // æ¯æ¬¡é¸æ“‡å¾Œæ›´æ–°æŒ‰éˆ•ç‹€æ…‹
        }

        // æ›´æ–°å°èˆªæŒ‰éˆ•ç‹€æ…‹ (ä¸Šä¸€éšæ®µ/ä¸‹ä¸€éšæ®µ/æŸ¥çœ‹çµæœ)
        function updateNavigationButtons() {
            // ä¸Šä¸€éšæ®µæŒ‰éˆ•
            if (currentStageIndex > 0) {
                prevStageBtn.classList.remove('hidden');
            } else {
                prevStageBtn.classList.add('hidden');
            }

            // ä¸‹ä¸€éšæ®µ/æŸ¥çœ‹çµæœæŒ‰éˆ•
            const currentStageQuestions = stages[currentStageIndex].questions;
            let allAnsweredInCurrentStage = true;
            for (let i = 0; i < currentStageQuestions.length; i++) {
                const globalIndex = getQuestionGlobalIndex(currentStageIndex, i);
                if (userAnswers[globalIndex] === undefined) {
                    allAnsweredInCurrentStage = false;
                    break;
                }
            }

            if (currentStageIndex === stages.length - 1) {
                nextStageBtn.innerText = 'æŸ¥çœ‹çµæœ';
                nextStageBtn.dataset.direction = 'result';
            } else {
                nextStageBtn.innerText = 'ä¸‹ä¸€éšæ®µ';
                nextStageBtn.dataset.direction = 'next';
            }

            // æ ¹æ“šæ˜¯å¦æ‰€æœ‰å•é¡Œéƒ½å·²å›ç­”ä¾†å•Ÿç”¨/ç¦ç”¨æŒ‰éˆ•
            if (!allAnsweredInCurrentStage) {
                nextStageBtn.classList.add('disabled');
                nextStageBtn.disabled = true;
            } else {
                nextStageBtn.classList.remove('disabled');
                nextStageBtn.disabled = false;
            }
        }

        // å°èˆªåˆ°ä¸‹ä¸€éšæ®µæˆ–ä¸Šä¸€éšæ®µ
        function navigateStage(direction) {
            if (direction === 'next') {
                if (currentStageIndex < stages.length - 1) {
                    currentStageIndex++;
                    renderStage();
                }
            } else if (direction === 'result') {
                calculateAndShowResult();
            } else if (direction === 'prev') {
                if (currentStageIndex > 0) {
                    currentStageIndex--;
                    renderStage();
                }
            }
        }

        // é‡æ–°è¨ˆç®— MBTI å’Œä¹å‹äººæ ¼åˆ†æ•¸ (é›–ç„¶çµæœéš¨æ©Ÿï¼Œä½†ä¿ç•™æ­¤å‡½æ•¸ä»¥ä¾›æ•¸æ“šå‚³è¼¸)
        function recalculateScores() {
            mbtiScores = { E: 0, I: 0, S: 0, N: 0, T: 0, F: 0, J: 0, P: 0 };
            enneagramScores = { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0, 7: 0, 8: 0, 9: 0 };

            let globalCounter = 0;
            stages.forEach(stage => {
                stage.questions.forEach((q, qIndex) => {
                    const selectedOptionIndex = userAnswers[globalCounter];
                    if (selectedOptionIndex !== undefined) {
                        const selectedOption = q.options[selectedOptionIndex];
                        // ç´¯è¨ˆ MBTI åˆ†æ•¸
                        for (const key in selectedOption.scores.mbti) {
                            mbtiScores[key] += selectedOption.scores.mbti[key];
                        }
                        // ç´¯è¨ˆä¹å‹äººæ ¼åˆ†æ•¸
                        for (const key in selectedOption.scores.enneagram) {
                            enneagramScores[key] += selectedOption.scores.enneagram[key];
                        }
                    }
                    globalCounter++;
                });
            });
        }

        // è¨ˆç®—æœ€çµ‚ MBTI é¡å‹ (ä¿ç•™æ­¤å‡½æ•¸ä»¥ä¾›æ•¸æ“šå‚³è¼¸)
        function calculateMBTI() {
            const e_i = mbtiScores.E >= mbtiScores.I ? 'E' : 'I';
            const s_n = mbtiScores.S >= mbtiScores.N ? 'S' : 'N';
            const t_f = mbtiScores.T >= mbtiScores.F ? 'T' : 'F';
            const j_p = mbtiScores.J >= mbtiScores.P ? 'J' : 'P';
            return e_i + s_n + t_f + j_p;
        }

        // è¨ˆç®—æœ€çµ‚ä¹å‹äººæ ¼é¡å‹ (ä¿ç•™æ­¤å‡½æ•¸ä»¥ä¾›æ•¸æ“šå‚³è¼¸)
        function calculateEnneagram() {
            let maxScore = -1;
            let maxType = '';
            for (const type in enneagramScores) {
                if (enneagramScores[type] > maxScore) {
                    maxScore = enneagramScores[type];
                    maxType = type;
                } else if (enneagramScores[type] === maxScore) {
                    // å¦‚æœåˆ†æ•¸ç›¸åŒï¼Œå„ªå…ˆé¸æ“‡æ•¸å­—è¼ƒå°çš„é¡å‹ (ä½œç‚ºä¸€å€‹è¦å‰‡)
                    if (parseInt(type) < parseInt(maxType)) {
                        maxType = type;
                    }
                }
            }
            return maxType ? `${maxType}è™Ÿ` : 'æœªçŸ¥é¡å‹';
        }

        // éš¨æ©Ÿç²å– N å€‹ä¸åŒçš„å…ƒç´  (ä¸åŒ…å«ç‰¹å®šå…ƒç´ )
        function getRandomUniqueElements(arr, count, excludeKeys = []) {
            const result = [];
            const available = arr.filter(key => !excludeKeys.includes(key));
            while (result.length < count && available.length > 0) {
                const randomIndex = Math.floor(Math.random() * available.length);
                result.push(available.splice(randomIndex, 1)[0]);
            }
            return result;
        }

        // è¨ˆç®—ä¸¦é¡¯ç¤ºçµæœ
        function calculateAndShowResult() {
            recalculateScores();

            quizContainer.classList.add('hidden');
            introContainer.classList.add('hidden');
            moreDetailsContainer.classList.add('hidden'); // ç¢ºä¿æ›´å¤šè©³æƒ…é éš±è—
            resultContainer.classList.remove('hidden');
            window.scrollTo(0, 0);

            const finalMBTI = calculateMBTI();
            const finalEnneagram = calculateEnneagram();
            console.log("æœ€çµ‚ MBTI é¡å‹: ", finalMBTI);
            console.log("æœ€çµ‚ä¹å‹äººæ ¼é¡å‹: ", finalEnneagram);
            console.log("MBTI åŸå§‹åˆ†æ•¸: ", mbtiScores);
            console.log("ä¹å‹äººæ ¼åŸå§‹åˆ†æ•¸: ", enneagramScores);

            // æ ¸å¿ƒä¿®æ”¹ï¼šé£Ÿç‰©äººæ ¼å®Œå…¨éš¨æ©Ÿé¸æ“‡
            const allFoodKeys = Object.keys(foodPersonalities);
            const finalFoodPersonalityKey = allFoodKeys[Math.floor(Math.random() * allFoodKeys.length)];
            const matchedFood = foodPersonalities[finalFoodPersonalityKey];

            finalFoodPersonalityElement.innerHTML = `<span class="emoji">${matchedFood.emoji}</span> ${matchedFood.name}`;
            foodPersonalityDescriptionElement.innerText = matchedFood.description;

            // é¡¯ç¤ºç”¨æˆ¶å§“å
            document.getElementById('userNameDisplay').innerText = userName || 'ä½ ';

            // éš¨æ©Ÿç”Ÿæˆé©åˆå’Œä¸é©åˆçš„é£Ÿç‰©
            const numSuitable = Math.floor(Math.random() * 2) + 2; // 2æˆ–3å€‹
            const numUnsuitable = Math.floor(Math.random() * 2) + 2; // 2æˆ–3å€‹

            const suitableFoodKeys = getRandomUniqueElements(allFoodKeys, numSuitable, [finalFoodPersonalityKey]);
            const unsuitableFoodKeys = getRandomUniqueElements(allFoodKeys, numUnsuitable, [finalFoodPersonalityKey, ...suitableFoodKeys]);

            // æ¸…ç©ºä¸¦å¡«å……é©åˆçš„é£Ÿç‰©ç¶²æ ¼
            suitableFoodsGrid.innerHTML = '';
            if (suitableFoodKeys.length > 0) {
                suitableFoodKeys.forEach(key => {
                    const food = foodPersonalities[key];
                    // ç§»é™¤äº† randomReason çš„é¡¯ç¤ºï¼Œåªä¿ç•™é£Ÿç‰©åç¨±å’Œ emoji
                    const foodCard = document.createElement('div');
                    foodCard.className = 'food-card';
                    foodCard.innerHTML = `
                        <span class="emoji">${food.emoji}</span>
                        <strong>${food.name}</strong>
                    `;
                    suitableFoodsGrid.appendChild(foodCard);
                });
            } else {
                const noFoodMessage = document.createElement('p');
                noFoodMessage.className = 'reason-text';
                noFoodMessage.innerText = 'ç›®å‰æ²’æœ‰ç‰¹åˆ¥åˆæ‹çš„é£Ÿç‰©ã€‚';
                suitableFoodsGrid.appendChild(noFoodMessage);
            }

            // æ¸…ç©ºä¸¦å¡«å……ä¸é©åˆçš„é£Ÿç‰©ç¶²æ ¼
            unsuitableFoodsGrid.innerHTML = '';
            if (unsuitableFoodKeys.length > 0) {
                unsuitableFoodKeys.forEach(key => {
                    const food = foodPersonalities[key];
                    // ç§»é™¤äº† randomReason çš„é¡¯ç¤ºï¼Œåªä¿ç•™é£Ÿç‰©åç¨±å’Œ emoji
                    const foodCard = document.createElement('div');
                    foodCard.className = 'food-card';
                    foodCard.innerHTML = `
                        <span class="emoji">${food.emoji}</span>
                        <strong>${food.name}</strong>
                    `;
                    unsuitableFoodsGrid.appendChild(foodCard);
                });
            } else {
                const noFoodMessage = document.createElement('p');
                noFoodMessage.className = 'reason-text';
                noFoodMessage.innerText = 'ç›®å‰æ²’æœ‰ç‰¹åˆ¥éœ€è¦å¤šé»ç†è§£çš„é£Ÿç‰©ã€‚';
                unsuitableFoodsGrid.appendChild(noFoodMessage);
            }

            // è§¸ç™¼åœ–ç‰‡ç”Ÿæˆå’Œé¡¯ç¤º
            generateAndDisplayResultImage(matchedFood, finalMBTI, finalEnneagram);
        }

        // ç”Ÿæˆä¸¦é¡¯ç¤ºçµæœåœ–ç‰‡
        function generateAndDisplayResultImage(matchedFood, mbti, enneagram) {
            // åœ¨æˆªåœ–å‰ï¼Œç¢ºä¿å›é¥‹å€å¡Šã€ä¸‹è¼‰æŒ‰éˆ•ã€æ›´å¤šè©³æƒ…æŒ‰éˆ•æ˜¯éš±è—çš„ï¼Œé¿å…æˆªåœ–åˆ°
            feedbackSection.classList.add('hidden');
            if (downloadImageBtn) downloadImageBtn.classList.add('hidden');
            saveImageHintText.classList.add('hidden');
            viewMoreDetailsBtn.classList.add('hidden'); // éš±è—æ›´å¤šè©³æƒ…æŒ‰éˆ•

            html2canvas(screenshotArea, {
                useCORS: true,
                allowTaint: true,
                scale: 2, // æé«˜è§£æåº¦
                backgroundColor: '#fdfdfd' // è¨­å®šèƒŒæ™¯è‰²
            }).then(canvas => {
                const dataURL = canvas.toDataURL('image/png');
                resultImagePreview.src = dataURL;

                // æˆªåœ–å®Œæˆå¾Œï¼Œéš±è—åŸå§‹çš„æ–‡å­—çµæœå€å¡Š
                screenshotArea.classList.add('hidden');

                // é¡¯ç¤ºåœ–ç‰‡é è¦½å€å¡Š
                document.getElementById('image-display-area').classList.remove('hidden');

                // é¡¯ç¤ºå›é¥‹å€å¡Šå’Œæ“ä½œæŒ‰éˆ•
                feedbackSection.classList.remove('hidden');
                if (downloadImageBtn) {
                    downloadImageBtn.classList.remove('hidden'); // é¡¯ç¤ºä¸‹è¼‰æŒ‰éˆ•
                    downloadImageBtn.href = dataURL;
                    downloadImageBtn.download = `${userName || 'æˆ‘çš„é£Ÿç‰©äººæ ¼'}_æ¸¬é©—çµæœ.png`;
                }
                saveImageHintText.classList.remove('hidden'); // é¡¯ç¤ºæ‰‹æ©Ÿé•·æŒ‰æç¤º

            }).catch(error => {
                console.error("åœ–ç‰‡ç”Ÿæˆå¤±æ•—ï¼š", error);
                alert("åœ–ç‰‡ç”Ÿæˆå¤±æ•—ï¼Œè«‹é‡è©¦ã€‚");
                // å³ä½¿å¤±æ•—ä¹Ÿè¦ç¢ºä¿æ“ä½œå€å¡Šå’Œå›é¥‹å€å¡Šå¯è¦‹
                feedbackSection.classList.remove('hidden');
                if (downloadImageBtn) downloadImageBtn.classList.remove('hidden');
                saveImageHintText.classList.remove('hidden');
                screenshotArea.classList.remove('hidden'); // å¤±æ•—æ™‚ä¸éš±è—åŸå§‹æ–‡å­—å€å¡Š
            });
        }


        // äº‹ä»¶ç›£è½å™¨
        startQuizBtn.addEventListener('click', () => {
            userName = userNameInput.value.trim();
            introContainer.classList.add('hidden');
            quizContainer.classList.remove('hidden');
            currentStageIndex = 0; // é‡ç½®éšæ®µç´¢å¼•
            userAnswers = {}; // æ¸…ç©ºç­”æ¡ˆ
            renderStage();
        });

        nextStageBtn.addEventListener('click', (event) => {
            navigateStage(event.target.dataset.direction);
        });

        prevStageBtn.addEventListener('click', (event) => {
            navigateStage(event.target.dataset.direction);
        });

        // çµæœé çš„é‡æ–°æ¸¬é©—æŒ‰éˆ•
        restartQuizBtn.addEventListener('click', () => {
            resetQuiz();
        });

        // æ›´å¤šè©³æƒ…é çš„é‡æ–°æ¸¬é©—æŒ‰éˆ•
        restartQuizBtnFromDetails.addEventListener('click', () => {
            resetQuiz();
        });

        // é‡ç½®æ¸¬é©—ç‹€æ…‹çš„å‡½æ•¸
        function resetQuiz() {
            resultContainer.classList.add('hidden');
            moreDetailsContainer.classList.add('hidden'); // ç¢ºä¿æ›´å¤šè©³æƒ…é éš±è—
            introContainer.classList.remove('hidden');
            userNameInput.value = ''; // æ¸…ç©ºå§“å
            currentStageIndex = 0; // é‡ç½®éšæ®µç´¢å¼•
            userAnswers = {}; // æ¸…ç©ºç­”æ¡ˆ
            mbtiScores = { E: 0, I: 0, S: 0, N: 0, T: 0, F: 0, J: 0, P: 0 };
            enneagramScores = { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0, 7: 0, 8: 0, 9: 0 };

            // é‡ç½®å›é¥‹æŒ‰éˆ•ç‹€æ…‹
            feedbackButtons.forEach(btn => {
                btn.classList.remove('active');
                btn.disabled = false;
            });
            // éš±è—åœ–ç‰‡é è¦½å’Œä¸‹è¼‰æŒ‰éˆ•/æç¤º
            resultImagePreview.src = ''; // æ¸…ç©ºåœ–ç‰‡æº
            if (downloadImageBtn) downloadImageBtn.classList.add('hidden');
            saveImageHintText.classList.add('hidden');
            
            // ç¢ºä¿å›é¥‹å€å¡Šå’ŒæŸ¥çœ‹æ›´å¤šæŒ‰éˆ•åœ¨é‡æ–°æ¸¬é©—æ™‚æ˜¯åˆå§‹ç‹€æ…‹
            feedbackSection.classList.remove('hidden'); // é¡¯ç¤ºå›é¥‹å€å¡Š
            viewMoreDetailsBtn.classList.add('hidden'); // éš±è—æŸ¥çœ‹æ›´å¤šæŒ‰éˆ•
            screenshotArea.classList.remove('hidden'); // é‡æ–°æ¸¬é©—æ™‚é¡¯ç¤ºæˆªåœ–å€åŸŸï¼Œä»¥ä¾¿ä¸‹æ¬¡ç”Ÿæˆåœ–ç‰‡
            document.getElementById('image-display-area').classList.add('hidden'); // éš±è—åœ–ç‰‡é¡¯ç¤ºå€å¡Š
        }


        feedbackButtons.forEach(button => {
            button.addEventListener('click', (event) => {
                // è¦–è¦ºå›é¥‹ï¼šç«‹å³éš±è—å›é¥‹å€å¡Šï¼Œé¡¯ç¤ºæ›´å¤šè©³æƒ…æŒ‰éˆ•
                feedbackButtons.forEach(btn => btn.classList.remove('active'));
                event.target.classList.add('active');
                feedbackSection.classList.add('hidden'); // ç«‹å³éš±è—å›é¥‹å€å¡Š
                viewMoreDetailsBtn.classList.remove('hidden'); // é¡¯ç¤ºæŸ¥çœ‹æ›´å¤šæŒ‰éˆ•

                const feedbackType = event.target.dataset.feedback;
                const finalMBTI = calculateMBTI(); // å†æ¬¡è¨ˆç®—ä»¥ç¢ºä¿æ•¸æ“šæœ€æ–°
                const finalEnneagram = calculateEnneagram();
                const finalFoodPersonality = finalFoodPersonalityElement.innerText.replace(/[\uD800-\uDBFF\uDC00-\uDFFF]/g, '').trim(); // ç§»é™¤ emoji

                const dataToSend = {
                    userName: userName,
                    foodPersonality: finalFoodPersonality,
                    mbtiType: finalMBTI,
                    enneagramType: finalEnneagram,
                    feedback: feedbackType
                };

                const backendApiUrl = 'https://food-quiz-python-backend.onrender.com/api/feedback'; // ç¢ºèª API URL

                fetch(backendApiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(dataToSend),
                })
                .then(response => {
                    if (!response.ok) {
                        return response.json().then(errorData => {
                            throw new Error(errorData.message || 'å›é¥‹ç™¼é€å¤±æ•—');
                        });
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('å›é¥‹æˆåŠŸ:', data);
                    // alert('æ„Ÿè¬æ‚¨çš„å›é¥‹ï¼'); // ç§»é™¤å½ˆçª—ï¼Œå› ç‚ºç¾åœ¨æœ‰æ›´å¤šè©³æƒ…æŒ‰éˆ•
                })
                .catch((error) => {
                    console.error('å›é¥‹ç™¼é€éŒ¯èª¤:', error);
                    alert(`å›é¥‹ç™¼é€å¤±æ•—ï¼š${error.message}ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚`);
                });
            });
        });

        // æŸ¥çœ‹æ›´å¤šè©³æƒ…æŒ‰éˆ•äº‹ä»¶
        viewMoreDetailsBtn.addEventListener('click', () => {
            resultContainer.classList.add('hidden');
            moreDetailsContainer.classList.remove('hidden');
            window.scrollTo(0, 0); // æ»¾å‹•åˆ°é é¢é ‚éƒ¨
        });

        // è¤‡è£½é€£çµæŒ‰éˆ•äº‹ä»¶
        copyLinkBtn.addEventListener('click', () => {
            shareLinkInput.select(); // é¸ä¸­æ–‡å­—
            shareLinkInput.setSelectionRange(0, 99999); // é‡å°è¡Œå‹•è£ç½®

            // ä½¿ç”¨ document.execCommand('copy') é€²è¡Œè¤‡è£½
            try {
                const successful = document.execCommand('copy');
                const msg = successful ? 'é€£çµå·²è¤‡è£½ï¼' : 'è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½ã€‚';
                alert(msg);
            } catch (err) {
                console.error('è¤‡è£½å¤±æ•—:', err);
                alert('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½ã€‚');
            }
        });


        // åˆå§‹åŒ–ï¼šç¢ºä¿é é¢åŠ è¼‰æ™‚é¡¯ç¤ºæ­¡è¿é é¢
        document.addEventListener('DOMContentLoaded', () => {
            introContainer.classList.remove('hidden');
            quizContainer.classList.add('hidden');
            resultContainer.classList.add('hidden');
            moreDetailsContainer.classList.add('hidden'); // ç¢ºä¿æ›´å¤šè©³æƒ…é é è¨­éš±è—

            // ç¢ºä¿åˆå§‹ç‹€æ…‹ä¸‹ä¸‹è¼‰æŒ‰éˆ•å’Œæ‰‹æ©Ÿæç¤ºæ˜¯éš±è—çš„
            if (downloadImageBtn) downloadImageBtn.classList.add('hidden');
            saveImageHintText.classList.add('hidden');
            screenshotArea.classList.remove('hidden'); // ç¢ºä¿åˆå§‹æ™‚æˆªåœ–å€åŸŸæ˜¯å¯è¦‹çš„
            document.getElementById('image-display-area').classList.add('hidden'); // éš±è—åœ–ç‰‡é¡¯ç¤ºå€å¡Š
            feedbackSection.classList.remove('hidden'); // ç¢ºä¿å›é¥‹å€å¡Šå¯è¦‹
            viewMoreDetailsBtn.classList.add('hidden'); // ç¢ºä¿æŸ¥çœ‹æ›´å¤šæŒ‰éˆ•éš±è—
        });

        // JavaScript ä»£ç¢¼çµæŸ
    </script>
</body>
</html>
