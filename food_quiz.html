<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é£Ÿç‰©äººæ ¼æ¸¬é©—</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;700&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        /* CSS Custom Properties for easier color management */
        :root {
            --primary-color: #4CAF50; /* æ·±ç¶ è‰² */
            --primary-light: #66BB6A; /* æ·ºç¶ è‰² */
            --secondary-color: #2196F3; /* è—è‰² */
            --secondary-light: #BBDEFB; /* æ·ºè—è‰² */
            --background-gradient-start: #eef7ff; /* æŸ”å’Œæ·ºè— */
            --background-gradient-end: #dceafc;    /* ç¨æ·±æ·ºè— */
            --card-background: #ffffff;
            --card-shadow: rgba(0, 0, 0, 0.15);
            --text-dark: #333;
            --text-medium: #555;
            --text-light: #666;
            --button-hover: #45a049;
            --option-bg-light: #e0f8e0; /* æ›´æŸ”å’Œçš„ç¶ è‰² */
            --option-border: #a7d9a9;
            --option-selected-bg: #c8e6c9;
            --result-bg: #fdfdfd;
            --result-shadow-inset: rgba(0, 0, 0, 0.03);
            --highlight-color: #ff8a00; /* æš–æ©™è‰² */
            --compatible-bg: #e3f2fd;
            --compatible-border: #bbdefb;
            --incompatible-bg: #ffe0b2; /* æŸ”å’Œæ©™è‰² */
            --incompatible-border: #ffcc80;
        }

        body {
            font-family: 'Noto Sans TC', 'Roboto', 'Arial', sans-serif;
            display: flex;
            justify-content: center;
            align-items: flex-start; /* ä¿æŒ flex-startï¼Œæ–¹ä¾¿æ²å‹• */
            min-height: 100vh;
            background: linear-gradient(135deg, var(--background-gradient-start) 0%, var(--background-gradient-end) 100%);
            margin: 0;
            padding: 30px; /* å¢åŠ æ•´é«”é‚Šè· */
            box-sizing: border-box;
            color: var(--text-dark);
            line-height: 1.6;
        }

        .container {
            background-color: var(--card-background);
            border-radius: 25px; /* æ›´å¤§çš„åœ“è§’ */
            box-shadow: 0 15px 40px var(--card-shadow); /* æ›´æ·±çš„é™°å½± */
            padding: 40px; /* å¢åŠ å…§é‚Šè· */
            text-align: center;
            max-width: 750px; /* ç•¥å¾®å¢åŠ æœ€å¤§å¯¬åº¦ */
            width: 100%;
            transition: all 0.5s ease-in-out;
            border: 2px solid rgba(255, 255, 255, 0.8); /* è¼•å¾®çš„ç™½è‰²é‚Šæ¡† */
            overflow: hidden; /* ç¢ºä¿å…§å®¹ä¸è¶…å‡ºåœ“è§’ */
            position: relative; /* ç‚ºäº†å¯èƒ½çš„è£é£¾å…ƒç´  */
        }

        /* è¼•å¾®çš„æ¼¸è®Šé‚Šæ¡†æ•ˆæœ */
        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 25px;
            padding: 2px;
            background: linear-gradient(45deg, var(--primary-light), var(--secondary-light));
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            pointer-events: none; /* è®“é»æ“Šç©¿é€åˆ°ä¸‹é¢çš„å…§å®¹ */
        }

        .hidden {
            display: none !important; /* ä½¿ç”¨ !important ç¢ºä¿å¼·åˆ¶éš±è— */
        }

        h1 {
            color: var(--primary-color);
            margin-bottom: 30px;
            font-size: 2.8em; /* æ›´å¤§çš„æ¨™é¡Œ */
            letter-spacing: 1.5px;
            font-weight: 700;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.05);
        }

        h2 {
            color: var(--text-medium);
            font-size: 1.8em;
            margin-bottom: 10px;
            font-weight: 400;
        }

        h3 {
            color: var(--secondary-color);
            font-size: 1.6em; /* èª¿æ•´çµæœé æ¨™é¡Œå¤§å° */
            margin-bottom: 15px;
            border-bottom: 2px solid var(--secondary-light);
            padding-bottom: 8px;
            font-weight: 700;
        }

        /* èª¿æ•´é¦–é çš„ä»‹ç´¹æ–‡å­—æ¨£å¼ */
        #intro-container .intro-text { /* æ–°å¢çš„ class */
            font-size: 1.2em; /* å•é¡Œæ–‡å­—æ›´å¤§ */
            margin: 0 auto 30px auto; /* ä¸Šä¸‹é‚Šè·ï¼Œå·¦å³è‡ªå‹•å¯¦ç¾ç½®ä¸­ */
            color: var(--text-medium);
            line-height: 1.7;
            font-weight: 300;
            text-align: center; /* é¦–é æ–‡å­—ç½®ä¸­ */
            max-width: 80%; /* é™åˆ¶å¯¬åº¦ */
        }
        /* æ¸¬é©—å•é¡Œçš„æ–‡å­—æ¨£å¼ä¿æŒä¸è®Š */
        .question-text {
            font-size: 1.2em; /* å•é¡Œæ–‡å­—æ›´å¤§ */
            margin-bottom: 25px;
            color: var(--text-medium);
            line-height: 1.7;
            font-weight: 300;
            text-align: left; /* å•é¡Œæ–‡å­—é å·¦ */
            border-left: 4px solid var(--primary-light);
            padding-left: 15px;
            margin-top: 30px; /* èˆ‡ä¸Šæ–¹å¼•æ–‡é–“è· */
        }

        .stage-intro {
            font-size: 1.3em;
            color: var(--secondary-color);
            margin-bottom: 30px;
            line-height: 1.8;
            font-weight: 400;
            text-align: center;
            background-color: var(--background-gradient-start);
            padding: 20px 25px;
            border-radius: 15px;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.05);
            border: 1px dashed var(--secondary-light);
        }

        .question-block {
            margin-bottom: 40px; /* æ¯å€‹å•é¡Œå€å¡Šçš„é–“è· */
            border-bottom: 1px dashed rgba(0, 0, 0, 0.1);
            padding-bottom: 30px;
        }

        .question-block:last-child {
            border-bottom: none; /* æœ€å¾Œä¸€å€‹å•é¡Œå€å¡Šæ²’æœ‰åº•ç·š */
            padding-bottom: 0;
            margin-bottom: 0;
        }


        .options-container {
            display: flex;
            flex-direction: column;
            gap: 15px; /* å¢åŠ é¸é …é–“è· */
        }

        .option-btn {
            background-color: var(--option-bg-light);
            color: var(--primary-color);
            border: 1px solid var(--option-border); /* ç´°é‚Šæ¡† */
            padding: 14px 25px; /* å¢åŠ å…§é‚Šè· */
            border-radius: 12px; /* æ›´å¤§çš„åœ“è§’ */
            font-size: 1.1em; /* å­—é«”æ›´å¤§ */
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease, border-color 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08); /* æ›´æ˜é¡¯çš„é™°å½± */
            text-align: left;
            font-weight: 400;
        }

        .option-btn:hover {
            background-color: var(--option-selected-bg);
            transform: translateY(-3px); /* æ›´æ˜é¡¯çš„æŠ¬å‡ */
            border-color: var(--primary-color);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.12);
        }

        .option-btn.selected {
            background-color: var(--primary-light);
            color: white;
            border-color: var(--primary-color);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            font-weight: 700; /* é¸ä¸­å¾ŒåŠ ç²— */
        }

        .option-btn:active {
            transform: translateY(0);
            background-color: var(--primary-color);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            gap: 20px; /* æŒ‰éˆ•é–“è· */
        }

        .stage-nav-btn {
            background: linear-gradient(45deg, var(--primary-color), var(--primary-light)); /* æ¼¸è®ŠèƒŒæ™¯ */
            color: white;
            border: none;
            padding: 14px 30px; /* å¢åŠ å…§é‚Šè· */
            border-radius: 10px; /* æ›´å¤§çš„åœ“è§’ */
            font-size: 1.15em; /* å­—é«”æ›´å¤§ */
            cursor: pointer;
            flex-grow: 1; /* è®“æŒ‰éˆ•å¹³å‡åˆ†é…ç©ºé–“ */
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease, background 0.3s ease;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2); /* æ›´æ˜é¡¯çš„é™°å½± */
            font-weight: 700;
        }

        .stage-nav-btn:hover {
            background: linear-gradient(45deg, var(--primary-light), var(--primary-color)); /* æ¼¸è®Šåè½‰ */
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.25);
        }

        .stage-nav-btn:active {
            transform: translateY(0);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
        }

        /* ä¸Šä¸€éšæ®µæŒ‰éˆ•çš„æ¨£å¼å¾®èª¿ */
        .stage-nav-btn.prev-btn {
            background: linear-gradient(45deg, #78909C, #90A4AE); /* ä¸åŒçš„æ¼¸è®Šè‰² */
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
        }
        .stage-nav-btn.prev-btn:hover {
            background: linear-gradient(45deg, #90A4AE, #78909C);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }

        /* å§“åè¼¸å…¥æ¬„ä½ */
        .name-input-group {
            margin-bottom: 25px;
            text-align: left;
            padding: 0 20px; /* è®“è¼¸å…¥æ¡†å’Œæ¨™ç±¤æœ‰å…§é‚Šè· */
        }
        .name-input-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 1.1em;
            color: var(--text-medium);
            font-weight: 500;
        }
        .name-input-group input[type="text"] {
            width: calc(100% - 20px); /* è€ƒæ…® padding */
            padding: 12px 10px;
            border: 1px solid var(--option-border);
            border-radius: 8px;
            font-size: 1.1em;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.08);
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .name-input-group input[type="text"]:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.2); /* ç¶ è‰²å…‰æšˆæ•ˆæœ */
        }

        /* çµæœé æ¨£å¼ */
        #result-container {
            padding: 30px;
            background-color: var(--result-bg);
            border-radius: 20px;
            box-shadow: inset 0 0 15px var(--result-shadow-inset); /* æŸ”å’Œå…§é™°å½± */
            margin-top: 20px;
            text-align: left; /* è®“æ–‡å­—é å·¦å°é½Š */
        }

        #final-food-personality {
            font-size: 4em; /* æœ€çµ‚é£Ÿç‰©äººæ ¼å­—é«”è¶…å¤§ */
            margin-bottom: 20px;
            color: var(--highlight-color); /* çªå‡ºé¡è‰² */
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(255, 138, 0, 0.2); /* è¼•å¾®æ–‡å­—é™°å½± */
        }

        #final-food-personality .emoji {
            font-size: 1.8em; /* è¡¨æƒ…ç¬¦è™Ÿæ›´å¤§ */
            vertical-align: middle;
        }

        #food-personality-description {
            font-size: 1.3em; /* æè¿°æ–‡å­—æ›´å¤§ */
            color: var(--text-light);
            line-height: 1.9; /* å¢åŠ è¡Œé«˜ */
            margin-bottom: 35px;
            text-align: justify; /* å·¦å³å°é½Š */
            text-indent: 2.5em; /* é¦–è¡Œç¸®æ’ */
            background-color: rgba(240, 248, 255, 0.6); /* è¼•å¾®èƒŒæ™¯è‰² */
            padding: 20px;
            border-radius: 10px;
            border: 1px solid rgba(var(--secondary-light), 0.5);
        }

        #compatibility-container {
            margin-top: 40px;
            border-top: 1px dashed #ddd;
            padding-top: 25px;
            text-align: left;
        }

        #compatibility-container ul {
            list-style: none;
            padding: 0;
            margin-bottom: 25px; /* å¢åŠ åˆ—è¡¨é–“è· */
        }

        #compatibility-container ul li {
            background-color: var(--compatible-bg); /* åˆæ‹é£Ÿç‰©çš„èƒŒæ™¯ */
            border: 1px solid var(--compatible-border);
            padding: 15px;
            margin-bottom: 12px;
            border-radius: 10px;
            font-size: 1.15em;
            line-height: 1.6;
            color: var(--text-dark);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        #compatibility-container ul li:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        #compatibility-container ul li strong {
            color: var(--secondary-color); /* åˆæ‹é£Ÿç‰©åç¨±é¡è‰² */
            font-weight: bold;
        }
        #compatibility-container ul li strong .emoji { /* åˆæ‹é£Ÿç‰©çš„ emoji æ¨£å¼ */
            font-size: 1em;
            vertical-align: middle;
            margin-left: 5px; /* ç¨å¾®èˆ‡æ–‡å­—åˆ†é›¢ */
        }


        #unsuitable-foods-with-reason li {
            background-color: var(--incompatible-bg); /* ä¸åˆæ‹é£Ÿç‰©çš„èƒŒæ™¯ */
            border-color: var(--incompatible-border);
        }

        #unsuitable-foods-with-reason li strong {
            color: var(--highlight-color); /* ä¸åˆæ‹é£Ÿç‰©åç¨±é¡è‰² */
            font-weight: bold;
        }
        #unsuitable-foods-with-reason li strong .emoji { /* ä¸åˆæ‹é£Ÿç‰©çš„ emoji æ¨£å¼ */
            font-size: 1em;
            vertical-align: middle;
            margin-left: 5px;
        }

        /* å›é¥‹å•å·æ¨£å¼ */
        .feedback-buttons {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap; /* å°è¢å¹•æ›è¡Œ */
        }
        .feedback-buttons button {
            background-color: #f0f0f0;
            color: var(--text-medium);
            border: 1px solid #ccc;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1; /* è®“æŒ‰éˆ•å¹³å‡åˆ†é…ç©ºé–“ */
            min-width: 120px; /* æœ€å°å¯¬åº¦ */
            max-width: 180px; /* æœ€å¤§å¯¬åº¦ */
        }
        .feedback-buttons button:hover:not(:disabled) {
            background-color: #e0e0e0;
            transform: translateY(-2px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .feedback-buttons button.active {
            background-color: var(--secondary-color);
            color: white;
            border-color: var(--secondary-color);
            box-shadow: 0 4px 8px rgba(33, 150, 243, 0.3);
            transform: translateY(-1px);
        }
        .feedback-buttons button:disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }

        .disclaimer {
            margin-top: 30px; /* èˆ‡ä¸Šæ–¹æŒ‰éˆ•çš„è·é›¢ */
            font-size: 0.9em;
            color: #888;
            text-align: center;
            background-color: rgba(255, 255, 255, 0.5);
            padding: 10px 20px;
            border-radius: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            backdrop-filter: blur(5px); /* æ¯›ç»ç’ƒæ•ˆæœ */
            -webkit-backdrop-filter: blur(5px);
            width: 100%; /* ç¢ºä¿æ©«å‘ä½”æ»¿ */
            max-width: 650px; /* èˆ‡å®¹å™¨ç›¸åŒå¯¬åº¦ */
            box-sizing: border-box; /* åŒ…å« padding åœ¨å¯¬åº¦å…§ */
            margin-left: auto; /* ç½®ä¸­ */
            margin-right: auto; /* ç½®ä¸­ */
        }

        /* é¦–é å®¹å™¨çš„ Flexbox ä½ˆå±€ï¼Œè®“å…§å®¹ç½®ä¸­ */
        #intro-container {
            display: flex;
            flex-direction: column;
            align-items: center; /* æ°´å¹³ç½®ä¸­ */
            justify-content: center; /* å‚ç›´ç½®ä¸­ (å¦‚æœç©ºé–“å…è¨±) */
            height: 100%; /* ç¢ºä¿ä½”æ“šçˆ¶å®¹å™¨çš„é«˜åº¦ */
        }

        /* éŸ¿æ‡‰å¼è¨­è¨ˆèª¿æ•´ */
        @media (max-width: 768px) {
            body {
                padding: 15px;
            }
            .container {
                padding: 30px;
                border-radius: 20px;
            }
            .container::before {
                border-radius: 20px;
            }
            h1 {
                font-size: 2.2em;
                margin-bottom: 20px;
            }
            #intro-container .intro-text {
                font-size: 1.1em;
                margin-bottom: 20px;
            }
            .question-text {
                font-size: 1.1em;
                margin-bottom: 20px;
                padding-left: 10px;
            }
            .stage-intro {
                font-size: 1.1em;
                padding: 15px 20px;
            }
            .option-btn {
                font-size: 1.05em;
                padding: 12px 20px;
            }
            .navigation-buttons {
                flex-direction: column; /* å°è¢å¹•ä¸‹æŒ‰éˆ•å‚ç›´æ’åˆ— */
                gap: 15px;
            }
            .stage-nav-btn {
                padding: 12px 25px;
                font-size: 1.1em;
                /* margin-top: 0px; é€™è£¡çš„ margin-top ä¸å†éœ€è¦ï¼Œå› ç‚º flex-direction: column; å’Œ gap å·²ç¶“è™•ç†äº† */
            }
            #final-food-personality {
                font-size: 3em;
                gap: 10px;
            }
            #final-food-personality .emoji {
                font-size: 1.5em;
            }
            #food-personality-description {
                font-size: 1.1em;
                padding: 15px;
            }
            #compatibility-container h3 {
                font-size: 1.5em;
            }
            #compatibility-container ul li {
                font-size: 1.05em;
                padding: 12px;
            }
            .feedback-buttons button {
                padding: 8px 12px;
                font-size: 0.9em;
                min-width: unset; /* ç§»é™¤æœ€å°å¯¬åº¦é™åˆ¶ */
                max-width: unset;
                flex-basis: auto; /* è‡ªå‹•èª¿æ•´å¯¬åº¦ */
            }
            .disclaimer {
                max-width: 550px;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 20px;
            }
            h1 {
                font-size: 1.8em;
            }
            #intro-container .intro-text {
                font-size: 0.95em;
                margin-bottom: 15px;
            }
            .question-text {
                font-size: 0.95em;
                margin-bottom: 15px;
            }
            .stage-intro {
                font-size: 1em;
                padding: 10px 15px;
            }
            .option-btn {
                font-size: 0.9em;
                padding: 10px 15px;
            }
            .navigation-buttons {
                gap: 10px;
            }
            .stage-nav-btn {
                padding: 10px 20px;
                font-size: 1em;
            }
            #final-food-personality {
                font-size: 2.5em;
                flex-direction: column; /* å°è¢å¹•ä¸‹è®“ emoji å’Œæ–‡å­—å‚ç›´æ’åˆ— */
            }
            #final-food-personality .emoji {
                font-size: 1.3em;
            }
            #food-personality-description {
                font-size: 0.95em;
                text-indent: 1.5em;
            }
            #compatibility-container h3 {
                font-size: 1.3em;
            }
            #compatibility-container ul li {
                font-size: 0.9em;
                padding: 10px;
            }
            .feedback-buttons button {
                padding: 8px 12px;
                font-size: 0.9em;
                min-width: unset; /* ç§»é™¤æœ€å°å¯¬åº¦é™åˆ¶ */
                max-width: unset;
                flex-basis: auto; /* è‡ªå‹•èª¿æ•´å¯¬åº¦ */
            }
            .disclaimer {
                margin-top: 20px;
                padding: 8px 15px;
                max-width: 350px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="intro-container">
            <h1>æ¸¬æ¸¬ä½ æ˜¯ä»€éº¼é£Ÿç‰©äººæ ¼ï¼</h1>
            <p class="intro-text">åœ¨ç¹å¿™çš„æ—¥å¸¸ç”Ÿæ´»ä¸­ï¼Œä½ æ˜¯å¦æœ‰éä¸€äº›éš±è—çš„ç‰¹è³ªï¼Œå°±åƒä¸åŒçš„é£Ÿç‰©ä¸€æ¨£ï¼Œæ“æœ‰ç¨ç‰¹çš„é¢¨å‘³å’Œå€‹æ€§ï¼Ÿå¿«ä¾†æ¸¬æ¸¬çœ‹ï¼Œä½ æ˜¯å“ªç¨®ç¾å‘³çš„é£Ÿç‰©äººæ ¼ï¼</p>
            <div class="name-input-group">
                <label for="userName">è¼¸å…¥ä½ çš„æš±ç¨± (é¸å¡«):</label>
                <input type="text" id="userName" placeholder="ä¾‹å¦‚ï¼šç¾é£Ÿå®¶å°æ">
            </div>
            <button id="startQuizBtn" class="stage-nav-btn">é–‹å§‹æ¸¬é©—</button>
            <div class="disclaimer" id="introDisclaimer">
                <p>â€» æœ¬æ¸¬é©—ç‚ºè¶£å‘³æ€§è³ªï¼Œçµæœåƒ…ä¾›åƒè€ƒèˆ‡å¨›æ¨‚ï¼Œä¸ä»£è¡¨å°ˆæ¥­æ€§æ ¼è©•ä¼°ã€‚</p>
            </div>
        </div>

        <div id="quiz-container" class="hidden">
            <div id="current-stage-content"></div>
            <div class="navigation-buttons">
                <button id="prevStageBtn" class="stage-nav-btn prev-btn hidden">ä¸Šä¸€éšæ®µ</button>
                <button id="nextStageBtn" class="stage-nav-btn">ä¸‹ä¸€éšæ®µ</button>
            </div>
        </div>

        <div id="result-container" class="hidden">
            <h2>ä½ å°±åƒ...</h2>
            <h3 id="final-food-personality"></h3>
            <p id="food-personality-description"></p>
            <div id="compatibility-container">
                <h3>é©åˆä½ çš„é£Ÿç‰©æ­é…</h3>
                <ul id="suitable-foods-with-reason"></ul>
                <h3>ä½ å¯èƒ½éœ€è¦é¿é–‹çš„é£Ÿç‰©</h3>
                <ul id="unsuitable-foods-with-reason"></ul>
            </div>
            <div class="disclaimer" id="resultDisclaimer">
                <p>â€» æœ¬æ¸¬é©—ç‚ºè¶£å‘³æ€§è³ªï¼Œçµæœåƒ…ä¾›åƒè€ƒèˆ‡å¨›æ¨‚ï¼Œä¸ä»£è¡¨å°ˆæ¥­æ€§æ ¼è©•ä¼°ã€‚</p>
            </div>

            <div id="feedback-section">
                <p style="margin-top:25px;"><strong>ä½ è¦ºå¾—é€™å€‹æ¸¬é©—çµæœç¬¦åˆä½ å—ï¼Ÿ</strong></p>
                <div class="feedback-buttons">
                    <button data-feedback="yes">éå¸¸ç¬¦åˆï¼</button>
                    <button data-feedback="somewhat">æœ‰é»ç¬¦åˆ</button>
                    <button data-feedback="no">ä¸å¤ªç¬¦åˆ</button>
                </div>
                <button id="saveResultImage" class="stage-nav-btn">å„²å­˜çµæœç‚ºåœ–ç‰‡</button>
                <button id="restartQuizBtn" class="stage-nav-btn">é‡æ–°æ¸¬é©—</button>
            </div>
        </div>
    </div>

    <script>
        const userNameInput = document.getElementById('userName');
        const startQuizBtn = document.getElementById('startQuizBtn');
        const introContainer = document.getElementById('intro-container');
        const quizContainer = document.getElementById('quiz-container');
        const resultContainer = document.getElementById('result-container');
        const currentStageContent = document.getElementById('current-stage-content');
        const prevStageBtn = document.getElementById('prevStageBtn');
        const nextStageBtn = document.getElementById('nextStageBtn');
        const finalFoodPersonality = document.getElementById('final-food-personality');
        const foodPersonalityDescription = document.getElementById('food-personality-description');
        const suitableFoodsList = document.getElementById('suitable-foods-with-reason');
        const unsuitableFoodsList = document.getElementById('unsuitable-foods-with-reason');
        const saveResultImageBtn = document.getElementById('saveResultImage');
        const restartQuizBtn = document.getElementById('restartQuizBtn');
        const feedbackButtons = document.querySelector('.feedback-buttons');
        const introDisclaimer = document.getElementById('introDisclaimer');
        const resultDisclaimer = document.getElementById('resultDisclaimer');

        let userName = '';
        let currentStage = 0;
        let userAnswers = {}; // Store answers for each question within a stage
        let totalScores = {
            'E': 0, 'I': 0, // Extroversion/Introversion
            'S': 0, 'N': 0, // Sensing/Intuition
            'T': 0, 'F': 0, // Thinking/Feeling
            'J': 0, 'P': 0, // Judging/Perceiving
            'Type1': 0, 'Type2': 0, 'Type3': 0, 'Type4': 0, 'Type5': 0, 'Type6': 0, 'Type7': 0, 'Type8': 0, 'Type9': 0 // Enneagram Types
        };

        const quizStages = [
            // Stage 0: Personality Test (MBTI-like)
            {
                title: 'âœ¨ éšæ®µä¸€ï¼šåˆç™»å ´èˆ‡è‡ªæˆ‘é©æ‡‰ âœ¨',
                intro: 'æ­¡è¿ä¾†åˆ°é£Ÿç‰©ç”Ÿå­˜å¤§è³½ï¼ä½ å‰›ç™¼ç¾è‡ªå·±è®Šæˆäº†ä¸€å¡Šé£Ÿç‰©ã€‚é€™ç¬¬ä¸€å€‹éšæ®µå°‡æ¢ç´¢ä½ åœ¨å…¨æ–°ç’°å¢ƒä¸‹çš„åˆå§‹åæ‡‰å’Œå¦‚ä½•é©æ‡‰é€™å€‹å¥‡å¦™çš„æ–°èº«ä»½ã€‚',
                questions: [
                    {
                        question: "1. ä¸€è¦ºé†’ä¾†ï¼Œä½ ç™¼ç¾è‡ªå·±è®Šæˆäº†ä¸€å¡Šé£Ÿç‰©ï¼Œä½ çš„ç¬¬ä¸€åæ‡‰ï¼Ÿ",
                        options: [
                            { text: "å…ˆè§€å¯Ÿå‘¨åœç’°å¢ƒï¼Œä¸æ…Œä¸å¿™", scores: { mbti: { I: 2, S: 1, J: 1 }, enneagram: { 5: 2, 6: 1 } } },
                            { text: "ã€Œä¹Ÿå¤ªå¥½ç©äº†å§ï¼ã€ç«‹åˆ»æƒ³æ‹ vlog", scores: { mbti: { E: 2, N: 1, P: 1 }, enneagram: { 7: 2, 3: 1 } } },
                            { text: "é¦¬ä¸Šæ“¬å®šé€ƒè„«è¨ˆç•«", scores: { mbti: { I: 1, N: 2, T: 1, J: 1 }, enneagram: { 1: 2, 8: 1 } } },
                            { text: "æ·¡æ·¡åœ°æ¥å—å‘½é‹ï¼Œæ„Ÿå˜†äººç”Ÿå¤šè®Š", scores: { mbti: { I: 1, N: 1, F: 2, P: 1 }, enneagram: { 4: 2, 9: 1 } } }
                        ]
                    },
                    {
                        question: "2. åœ¨é€™å€‹å…¨æ–°çš„é£Ÿç‰©ä¸–ç•Œï¼Œä½ éœ€è¦å‘ä¸€ç¾¤é™Œç”Ÿé£Ÿç‰©è‡ªæˆ‘ä»‹ç´¹ï¼Œä½ æœƒï¼Ÿ",
                        options: [
                            { text: "ç†±æƒ…é–‹å ´ï¼Œé‚„å¹«åˆ¥äººä»‹ç´¹", scores: { mbti: { E: 2, F: 1 }, enneagram: { 2: 2, 7: 1 } } },
                            { text: "ç°¡çŸ­è¬›å®Œå°±æƒ³å¿«é–ƒ", scores: { mbti: { I: 2, T: 1 }, enneagram: { 5: 2, 6: 1 } } },
                            { text: "è¬›å¾—å¾ˆå“²å­¸ï¼Œå¸Œæœ›æœ‰äººæ‡‚ä½ ", scores: { mbti: { I: 1, N: 1, F: 2 }, enneagram: { 4: 2, 9: 1 } } },
                            { text: "å·å·è§€å¯Ÿå…¶ä»–äººå¦‚ä½•åšå†è¡Œå‹•", scores: { mbti: { I: 2, S: 1, J: 1 }, enneagram: { 6: 2, 9: 1 } } }
                        ]
                    },
                    {
                        question: "3.ä½ æœ€å¸Œæœ›è‡ªå·±æˆç‚ºæ€æ¨£çš„é£Ÿç‰©ï¼Œæœƒè®“å¤§å®¶è¨˜ä½ä½ ï¼Ÿ",
                        options: [
                            { text: "æœ‰æ„›å¿ƒä¸”è¢«å¤§å®¶éœ€è¦", scores: { mbti: { E: 1, S: 1, F: 2, J: 1 }, enneagram: { 2: 2, 9: 1 } } },
                            { text: "å‹‡æ•¢ä¸”æˆå°±éå‡¡", scores: { mbti: { E: 1, N: 1, T: 2, J: 1 }, enneagram: { 8: 2, 3: 1 } } },
                            { text: "ç¨ç‰¹ä¸”å……æ»¿å‰µæ„", scores: { mbti: { I: 1, N: 2, F: 1, P: 1 }, enneagram: { 4: 2, 7: 1 } } },
                            { text: "å®‰ç©©å¯é ï¼Œå€¼å¾—ä¿¡è³´", scores: { mbti: { I: 1, S: 2, F: 1, J: 1 }, enneagram: { 6: 2, 1: 1 } } }
                        ]
                    },
                ]
            },
            // Stage 1: Lifestyle & Preferences (Enneagram-like aspects)
            {
                title: 'ğŸ¤ éšæ®µäºŒï¼šåœ˜éšŠçµ„å»ºèˆ‡åˆæ¬¡æŒ‘æˆ° ğŸ¤',
                intro: 'åœ¨é£Ÿç‰©ä¸–ç•Œè£¡ï¼Œåˆä½œæ˜¯ç”Ÿå­˜ä¹‹é“ã€‚ä½ å°‡èˆ‡å…¶ä»–é£Ÿç‰©çµ„æˆéšŠä¼ï¼Œå…±åŒé¢å°æ–™ç†ä»»å‹™ã€‚é€™å€‹éšæ®µè€ƒé©—ä½ çš„é ˜å°ã€å”ä½œèˆ‡æ‡‰è®Šèƒ½åŠ›ã€‚',
                questions: [
                    {
                        question: "4. é¢å°å³å°‡åˆ°ä¾†çš„åœ˜éšŠæŒ‘æˆ°ï¼Œä½ æœƒé¸æ“‡åœ¨éšŠä¼ä¸­æ‰®æ¼”ä»€éº¼è§’è‰²ï¼Ÿ",
                        options: [
                            { text: "éšŠä¼è£¡çš„åŠ©æ‰‹ï¼Œå”åŠ©å¤§å®¶", scores: { mbti: { E: 1, S: 1, F: 2, J: 1 }, enneagram: { 2: 2, 6: 1 } } },
                            { text: "é ˜å°è€…ï¼ŒæŒæ¡å…¨å±€", scores: { mbti: { E: 1, N: 1, T: 2, J: 1 }, enneagram: { 8: 2, 3: 1 } } },
                            { text: "è§€å¯Ÿè€…ï¼Œå†·éœåˆ†æ", scores: { mbti: { I: 2, N: 1, T: 1, P: 1 }, enneagram: { 5: 2, 1: 1 } } },
                            { text: "è‡ªç”±è¡Œå‹•è€…ï¼Œéˆæ´»æ‡‰è®Š", scores: { mbti: { E: 1, S: 2, P: 1 }, enneagram: { 7: 2, 8: 1 } } }
                        ]
                    },
                    {
                        question: "5. éšŠä¼ä¸­ï¼Œä½ è¢«é¸ç‚ºéšŠé•·ï¼Œè¦å¸¶é ˜å¤§å®¶å®Œæˆä¸€å€‹å›°é›£çš„æ–™ç†ä»»å‹™ï¼Œä½ æœƒï¼Ÿ",
                        options: [
                            { text: "å…¬é–‹è¡¨æ±ºï¼Œå¤§å®¶èªªäº†ç®—", scores: { mbti: { I: 1, S: 1, F: 2, J: 1 }, enneagram: { 9: 2, 2: 1 } } },
                            { text: "è¦ªè‡ªè¦åŠƒæˆ°è¡“èˆ‡åˆ†å·¥", scores: { mbti: { E: 1, N: 1, T: 2, J: 1 }, enneagram: { 8: 2, 1: 1 } } },
                            { text: "é»˜é»˜å®Œæˆæœ€å¤šäº‹æƒ…ä½†ä¸çˆ­åŠŸ", scores: { mbti: { I: 1, S: 2, T: 1, P: 1 }, enneagram: { 6: 2, 5: 1 } } },
                            { text: "ç”¨æ•…äº‹é¼“èˆå¤§å®¶çš„å¿ƒ", scores: { mbti: { E: 1, N: 1, F: 2, J: 1 }, enneagram: { 2: 2, 7: 1 } } }
                        ]
                    },
                    {
                        question: "6. è©•å¯©èªªä½ å¾ˆåƒã€Œç”œé»ç³»ã€é£Ÿç‰©ï¼Œé€™æœƒå½±éŸ¿ä½ çš„éšŠä¼åˆ†å·¥ï¼Œä½ æ€éº¼å›æ‡‰ï¼Ÿ",
                        options: [
                            { text: "ã€Œè¬è¬èª‡çï¼Œæˆ‘ä¹Ÿè¦ºå¾—æˆ‘å¾ˆé¦™ï¼ã€", scores: { mbti: { E: 2, S: 1, F: 1, P: 1 }, enneagram: { 3: 2, 7: 1 } } },
                            { text: "ã€Œæˆ‘å…¶å¯¦æ˜¯é¹¹çš„ï¼Œåˆ¥èª¤æœƒæˆ‘äº†ã€", scores: { mbti: { I: 1, S: 2, T: 1, J: 1 }, enneagram: { 1: 2, 8: 1 } } },
                            { text: "ã€Œä½ è¦ºå¾—åƒç”œçš„ï¼Œæ˜¯å› ç‚ºä½ ä¸æ‡‚æˆ‘ã€‚ã€", scores: { mbti: { I: 1, N: 1, F: 2, P: 1 }, enneagram: { 4: 2, 9: 1 } } },
                            { text: "ã€Œé‚£æˆ‘å°±ä¾†ç™¼æ®ç”œé»çš„æœ€å¤§åƒ¹å€¼ï¼ã€", scores: { mbti: { E: 1, N: 1, T: 2, J: 1 }, enneagram: { 8: 2, 3: 1 } } }
                        ]
                    },
                    {
                        question: "7. æ¯”è³½ä¸­é‡åˆ°ä¸€å€‹é—œéµé¸æ“‡ï¼Œä½ çš„éšŠä¼éœ€è¦æ±ºå®šä¸‹ä¸€æ­¥ç­–ç•¥ï¼Œä½ é€šå¸¸æ€éº¼åšï¼Ÿ",
                        options: [
                            { text: "åˆ†æåˆ©å¼Šå†æ±ºå®š", scores: { mbti: { I: 1, N: 2, T: 1, J: 1 }, enneagram: { 1: 2, 5: 1 } } },
                            { text: "è½å¾ç›´è¦ºèˆ‡æƒ…ç·’", scores: { mbti: { I: 1, N: 1, F: 2, P: 1 }, enneagram: { 4: 2, 7: 1 } } },
                            { text: "å•æœ‹å‹å¤§å®¶æ„è¦‹å¦‚ä½•", scores: { mbti: { E: 1, S: 1, F: 2, J: 1 }, enneagram: { 6: 2, 9: 1 } } },
                            { text: "å…ˆè¡å†èªªï¼Œä¹‹å¾Œå†èª¿æ•´", scores: { mbti: { E: 1, S: 2, P: 1 }, enneagram: { 7: 2, 8: 1 } } }
                        ]
                    },
                    {
                        question: "8.ã€Œé£Ÿç‰©ç•Œå¤§æˆ°ã€çš„è™Ÿè§’å³å°‡å¹éŸ¿ï¼Œä½ å€‘éšŠä¼æº–å‚™æ€éº¼æ‡‰å°é€™å ´æ±ºè³½ï¼Ÿ",
                        options: [
                            { text: "ä»”ç´°è¨ˆç•«èˆ‡æº–å‚™", scores: { mbti: { I: 2, S: 1, J: 1 }, enneagram: { 1: 2, 5: 1 } } },
                            { text: "éš¨é‡è€Œå®‰ï¼Œé©æ‡‰ç’°å¢ƒ", scores: { mbti: { I: 1, S: 2, P: 1 }, enneagram: { 6: 2, 9: 1 } } },
                            { text: "çµ„ç¹”åœ˜éšŠï¼Œç™¼æ®åˆä½œ", scores: { mbti: { E: 2, N: 1, F: 1, J: 1 }, enneagram: { 2: 2, 6: 1 } } },
                            { text: "è¡é‹’é™·é™£ï¼Œå‹‡å¾€ç›´å‰", scores: { mbti: { E: 1, S: 2, P: 1 }, enneagram: { 8: 2, 7: 1 } } }
                        ]
                    },
                ]
            },
            {
                title: 'ğŸ§  éšæ®µä¸‰ï¼šè³½ä¸­çªç™¼ç‹€æ³èˆ‡äººéš›è™•ç† ğŸ§ ',
                intro: 'æ¯”è³½ä¸­ç¸½æ˜¯å……æ»¿è®Šæ•¸ï¼Œäººéš›é—œä¿‚ä¹Ÿè¤‡é›œå¤šè®Šã€‚ä½ å°‡é¢å°çªç™¼ç‹€æ³å’Œäººéš›è€ƒé©—ï¼Œä½ çš„åæ‡‰å’Œè™•ç†æ–¹å¼å°‡æ±ºå®šä½ çš„é£Ÿç‰©äººæ ¼èµ°å‘ã€‚',
                questions: [
                    {
                        question: "9. æ¯”è³½æœŸé–“ï¼Œä½ ç™¼ç¾æœ‰æ•µéšŠçš„é£Ÿç‰©ä½œå¼Šï¼Œä½†ä»–å€‘æˆç¸¾æ–ç„¶ï¼Œä½ æœƒï¼Ÿ",
                        options: [
                            { text: "éŒ„å½±æª¢èˆ‰ï¼Œå…¬å¹³æœ€é‡è¦", scores: { mbti: { I: 1, S: 1, T: 2, J: 1 }, enneagram: { 1: 2, 8: 1 } } },
                            { text: "ç§ä¸‹æ‰¾ä»–è«‡è«‡ï¼Œå‹¸ä»–å¦ç™½", scores: { mbti: { I: 1, N: 1, F: 2, J: 1 }, enneagram: { 2: 2, 6: 1 } } },
                            { text: "é»˜é»˜è¨˜ä¸‹ä¾†ï¼Œä½†ä¸å‡ºè²", scores: { mbti: { I: 2, N: 1, T: 1, P: 1 }, enneagram: { 5: 2, 9: 1 } } },
                            { text: "æƒ³èªªé€™åªæ˜¯éŠæˆ²ï¼Œä½•å¿…è¼ƒçœŸ", scores: { mbti: { E: 1, S: 2, F: 1, P: 1 }, enneagram: { 7: 2, 3: 1 } } }
                        ]
                    },
                    {
                        question: "10. è©•å¯©çªç„¶è¦æ±‚ä½ é€²è¡Œä¸€å ´å³èˆˆçš„ã€Œé£Ÿææ­é…è¡¨æ¼”ã€ï¼Œä½ æœƒï¼Ÿ",
                        options: [
                            { text: "å¤§è†½è¡¨æ¼”ï¼Œæˆç‚ºç„¦é»", scores: { mbti: { E: 2, S: 1, P: 1 }, enneagram: { 3: 2, 7: 1 } } },
                            { text: "è¬¹æ…æº–å‚™ï¼Œæ±‚å®Œç¾", scores: { mbti: { I: 1, S: 1, T: 2, J: 1 }, enneagram: { 1: 2, 5: 1 } } },
                            { text: "ç™¼æ®å‰µæ„ï¼Œç©å‡ºæ–°èŠ±æ¨£", scores: { mbti: { E: 1, N: 2, P: 1 }, enneagram: { 7: 2, 4: 1 } } },
                            { text: "ä¿æŒå†·éœï¼Œç©©ç©©å®Œæˆ", scores: { mbti: { I: 1, S: 2, J: 1 }, enneagram: { 6: 2, 9: 1 } } }
                        ]
                    },
                    {
                        question: "11.ä½ çš„éšŠå‹ã€Œç»ç’ƒå¿ƒèµ·å¸é‹ã€å› ç‚ºè¡¨ç¾ä¸ä½³è€Œæƒ…ç·’å´©æ½°ï¼Œä½ æœƒï¼Ÿ",
                        options: [
                            { text: "è®“ä»–å“­ä¸€å“­å†æŠ±æŠ±", scores: { mbti: { I: 1, S: 1, F: 2, P: 1 }, enneagram: { 2: 2, 9: 1 } } },
                            { text: "ç›´æ¥å‘Šè¨´ä»–ã€Œä½ è¦å …å¼·ä¸€é»ï¼ã€", scores: { mbti: { E: 1, S: 2, T: 1, J: 1 }, enneagram: { 1: 2, 8: 1 } } },
                            { text: "è«‹åˆ¥äººå¹«æˆ‘è™•ç†ï¼Œæˆ‘ä¸æƒ³è¢«æƒ…ç·’å‹’ç´¢", scores: { mbti: { I: 2, N: 1, T: 1, P: 1 }, enneagram: { 5: 2, 4: 1 } } },
                            { text: "é™ªä»–ç•«ç•«èŠèŠå¤©ï¼Œè½‰ç§»æƒ…ç·’", scores: { mbti: { E: 1, N: 1, F: 2, P: 1 }, enneagram: { 4: 2, 7: 1 } } }
                        ]
                    },
                    {
                        question: "12. æœ‰åŒéšŠçš„é£Ÿç‰©æ¶èµ°äº†ä½ ç²¾å¿ƒæº–å‚™çš„ã€Œå‰µæ„é»å­ã€çš„åŠŸå‹ï¼Œä½ æœƒï¼Ÿ",
                        options: [
                            { text: "ç›´æ¥å°è³ªï¼Œç¶­è­·è‡ªå·±çš„æ¬Šç›Š", scores: { mbti: { E: 1, S: 1, T: 2, J: 1 }, enneagram: { 8: 2, 1: 1 } } },
                            { text: "å¿ƒè£¡ä¸æ»¿ï¼Œä½†é¸æ“‡å¿è€", scores: { mbti: { I: 1, S: 1, F: 2, P: 1 }, enneagram: { 9: 2, 6: 1 } } },
                            { text: "è©¦è‘—è½‰ç§»æ³¨æ„åŠ›ï¼Œé¿å…è¡çª", scores: { mbti: { E: 1, N: 1, F: 2, P: 1 }, enneagram: { 2: 2, 7: 1 } } },
                            { text: "æš—è‡ªåŠªåŠ›è­‰æ˜è‡ªå·±æ›´å¼·", scores: { mbti: { I: 1, N: 1, T: 2, J: 1 }, enneagram: { 1: 2, 3: 1 } } }
                        ]
                    },
                    {
                        question: "13. ä½ çš„éšŠå‹åœ¨æŸå€‹ç’°ç¯€ä¸å¹¸è¢«æ·˜æ±°äº†ï¼Œä½ æœƒï¼Ÿ",
                        options: [
                            { text: "ç«‹åˆ»å®‰æ…°ä¸¦å¹«å¿™", scores: { mbti: { E: 1, N: 1, F: 2, J: 1 }, enneagram: { 2: 2, 6: 1 } } },
                            { text: "é»˜é»˜æ„Ÿåˆ°é›£éï¼Œè‡ªå·±ä¹Ÿé™·å…¥ä½æ½®", scores: { mbti: { I: 1, N: 1, F: 2, P: 1 }, enneagram: { 4: 2, 9: 1 } } },
                            { text: "è¿…é€Ÿèª¿æ•´ç­–ç•¥ï¼Œç¹¼çºŒå‰é€²", scores: { mbti: { I: 1, N: 1, T: 2, J: 1 }, enneagram: { 8: 2, 3: 1 } } },
                            { text: "è¦ºå¾—æ˜¯è‡ªç„¶æ·˜æ±°ï¼Œæ²’ä»€éº¼å¤§ä¸äº†", scores: { mbti: { I: 1, S: 2, T: 1, P: 1 }, enneagram: { 5: 2, 1: 1 } } }
                        ]
                    },
                    {
                        question: "14. ä½ ç™¼ç¾ä½ æš—æˆ€çš„ã€Œç±³å…¶æ—ä¸»å»šã€ï¼ˆæˆ–å…¶ä»–è§’è‰²ï¼‰æ˜¯æ•µéšŠçš„é—œéµäººç‰©â€¦ï¼Ÿ",
                        options: [
                            { text: "æƒ³è¾¦æ³•å’Œä»–ç§ä¸‹è¯çµ¡", scores: { mbti: { E: 1, N: 2, F: 1, P: 1 }, enneagram: { 7: 2, 2: 1 } } },
                            { text: "éš±è—æƒ…æ„Ÿï¼Œå°ˆæ³¨æ¯”è³½", scores: { mbti: { I: 2, S: 1, T: 1, J: 1 }, enneagram: { 1: 2, 5: 1 } } },
                            { text: "è‹¦æƒ±åˆçŸ›ç›¾ï¼Œå¿ƒæƒ…è¤‡é›œ", scores: { mbti: { I: 1, N: 1, F: 2, P: 1 }, enneagram: { 4: 2, 6: 1 } } },
                            { text: "è¦ºå¾—é€™æ˜¯æœ‰è¶£çš„æŒ‘æˆ°", scores: { mbti: { E: 1, S: 2, P: 1 }, enneagram: { 8: 2, 7: 1 } } }
                        ]
                    },
                ]
            },
            {
                title: 'ğŸ”¥ éšæ®µå››ï¼šå£“åŠ›èˆ‡è‡ªçœ ğŸ”¥',
                intro: 'æ¯”è³½é€²å…¥ç™½ç†±åŒ–éšæ®µï¼Œå£“åŠ›å’ŒæŒ‘æˆ°æ¥è¸µè€Œä¾†ã€‚é€™å€‹éšæ®µå°‡æ·±å…¥ä½ çš„å…§å¿ƒï¼Œæ¢ç´¢ä½ å¦‚ä½•åœ¨å£“åŠ›ä¸‹è‡ªæˆ‘åæ€ï¼Œä»¥åŠä½ æœ€çè¦–çš„åƒ¹å€¼ã€‚',
                questions: [
                    {
                        question: "15. æ¯”è³½é€²å…¥æœ€çµ‚è¡åˆºï¼Œä½ çªç„¶é‡åˆ°ä¸€å€‹é æ–™ä¹‹å¤–çš„ã€Œé£Ÿæè®Šè³ªã€å±æ©Ÿï¼Œä½ çš„åæ‡‰æ˜¯ï¼Ÿ",
                        options: [
                            { text: "ç«‹åˆ»æƒ³è¾¦æ³•æ‡‰å°ä¸¦å¹«åŠ©ä»–äºº", scores: { mbti: { E: 1, N: 1, F: 2, J: 1 }, enneagram: { 6: 2, 2: 1 } } },
                            { text: "èº²èµ·ä¾†æ€è€ƒå“ªè£¡æœ€å®‰å…¨", scores: { mbti: { I: 2, N: 1, T: 1, P: 1 }, enneagram: { 5: 2, 9: 1 } } },
                            { text: "ã€Œé€™å¯èƒ½æ˜¯å‘½é‹çš„è€ƒé©—â€¦ã€é–‹å§‹è‡ªçœ", scores: { mbti: { I: 1, N: 1, F: 2, P: 1 }, enneagram: { 4: 2, 1: 1 } } },
                            { text: "ã€Œç‡ƒç‡’å§ï¼æˆ‘å°±æ˜¯ç«ç„°ï¼ã€ï¼ˆå‹‡æ•¢é¢å°å±æ©Ÿï¼‰", scores: { mbti: { E: 1, S: 2, P: 1 }, enneagram: { 8: 2, 7: 1 } } }
                        ]
                    },
                    {
                        question: "16. æ¯”è³½é–“éš™çš„çŸ­æš«ä¼‘æ¯æ™‚é–“ï¼Œä½ æœƒå¦‚ä½•åˆ©ç”¨ä¾†ã€Œå……é›»ã€ï¼Ÿ",
                        options: [
                            { text: "ç¨è‡ªæ²‰æ€ï¼Œå……é›»ä¼‘æ¯", scores: { mbti: { I: 2, N: 1, T: 1, J: 1 }, enneagram: { 5: 2, 1: 1 } } },
                            { text: "ç†±é¬§ç¤¾äº¤ï¼Œèªè­˜æ–°æœ‹å‹", scores: { mbti: { E: 2, S: 1, P: 1 }, enneagram: { 7: 2, 3: 1 } } },
                            { text: "å’Œç†Ÿæ‚‰çš„äººèŠèŠå¤©", scores: { mbti: { I: 1, S: 1, F: 2, J: 1 }, enneagram: { 9: 2, 6: 1 } } },
                            { text: "åšé»å–œæ­¡çš„å°äº‹æƒ…æ”¾é¬†", scores: { mbti: { I: 1, S: 1, F: 2, P: 1 }, enneagram: { 4: 2, 5: 1 } } }
                        ]
                    },
                    {
                        question: "17. åœ¨é€™å ´é£Ÿç‰©ç”Ÿå­˜å¤§è³½ä¸­ï¼Œä½ æœ€å®³æ€•å¤±å»ä»€éº¼ï¼Ÿ",
                        options: [
                            { text: "è¢«å¿½è¦–èˆ‡éºå¿˜", scores: { mbti: { I: 1, N: 1, F: 2, P: 1 }, enneagram: { 4: 2, 2: 1 } } },
                            { text: "å¤±æ§å’Œæ··äº‚", scores: { mbti: { E: 1, S: 1, T: 2, P: 1 }, enneagram: { 8: 2, 1: 1 } } },
                            { text: "ç„¡ç”¨èˆ‡è¢«æ‹’çµ•", scores: { mbti: { I: 1, S: 1, T: 2, J: 1 }, enneagram: { 1: 2, 3: 1 } } },
                            { text: "å­¤ç¨èˆ‡è¢«æ’æ–¥", scores: { mbti: { I: 1, S: 1, F: 2, J: 1 }, enneagram: { 6: 2, 9: 1 } } }
                        ]
                    },
                    {
                        question: "18. åœ¨ä¸€å ´æ¿€çƒˆçš„ã€Œé£Ÿç‰©ç†å¿µè¾¯è«–ã€ä¸­ï¼Œè©•å¯©å•ä½ ï¼šã€Œä½ ä½œç‚ºé£Ÿç‰©ï¼Œä½ å­˜åœ¨çš„æ„ç¾©æ˜¯ï¼Ÿã€ä½ èªªï¼Ÿ",
                        options: [
                            { text: "ã€Œç‚ºäº†è®“åˆ¥äººé–‹å¿ƒã€è¢«å–œæ­¡ï¼ã€", scores: { mbti: { E: 1, N: 1, F: 2, P: 1 }, enneagram: { 2: 2, 7: 1 } } },
                            { text: "ã€Œç‚ºäº†å®Œæˆä½¿å‘½ï¼ŒæŒ‘æˆ°æ¥µé™ã€‚ã€", scores: { mbti: { I: 1, N: 1, T: 2, J: 1 }, enneagram: { 8: 2, 3: 1 } } },
                            { text: "ã€Œæ²’æœ‰æ„ç¾©ï¼Œä½†æˆ‘æœƒè‡ªå·±å‰µé€ ã€‚ã€", scores: { mbti: { I: 1, N: 2, F: 1, P: 1 }, enneagram: { 4: 2, 5: 1 } } },
                            { text: "æˆ‘æ˜¯æä¾›è§£æ±ºæ–¹æ¡ˆçš„é‚£å€‹äººã€‚ã€", scores: { mbti: { I: 1, S: 1, T: 2, J: 1 }, enneagram: { 5: 2, 1: 1 } } }
                        ]
                    },
                ]
            },
            {
                title: 'ğŸ† éšæ®µäº”ï¼šæ±ºè³½èˆ‡æœ€çµ‚å®šè«– ğŸ†',
                intro: 'æ­å–œä½ ä¾†åˆ°æœ€å¾Œä¸€å€‹éšæ®µï¼æ‰€æœ‰çš„åŠªåŠ›éƒ½å°‡åœ¨é€™ä¸€åˆ»å¾—åˆ°å®šç¾©ã€‚ä½ çš„é¸æ“‡å°‡å¼•å°ä½ æ­ç¤ºä½ çš„çµ‚æ¥µé£Ÿç‰©äººæ ¼ï¼Œä¸¦å±•æœ›ä½ çš„é¢¨å‘³æœªä¾†ã€‚',
                questions: [
                    {
                        question: "19. ç¶“éé€™å ´é¢¨å‘³å¤§æˆ°çš„æ´—ç¦®ï¼Œå¦‚æœå¯ä»¥é¸æ“‡ã€Œé¢¨å‘³é‡ç”Ÿã€ï¼Œä½ æœƒé¸æ“‡æˆç‚ºæ€æ¨£çš„é£Ÿç‰©ï¼Ÿ",
                        options: [
                            { text: "æ²’äººèªå¾—æˆ‘ï¼Œæˆ‘å¯ä»¥é‡æ–°å®šç¾©è‡ªå·±", scores: { mbti: { I: 1, N: 2, F: 1, P: 1 }, enneagram: { 4: 2, 7: 1 } } },
                            { text: "åŠŸèƒ½å¼·å¤§ã€å—äººå€šè³´çš„è§’è‰²", scores: { mbti: { E: 1, S: 1, T: 2, J: 1 }, enneagram: { 3: 2, 8: 1 } } },
                            { text: "å¯æ„›åˆæœ‰äººä¿è­·æˆ‘", scores: { mbti: { I: 1, S: 1, F: 2, P: 1 }, enneagram: { 6: 2, 2: 1 } } },
                            { text: "è·Ÿç¾åœ¨ä¸€æ¨£ï¼Œæˆ‘è¦ºå¾—æˆ‘ä¸éŒ¯", scores: { mbti: { I: 1, S: 2, F: 1, J: 1 }, enneagram: { 9: 2, 1: 1 } } }
                        ]
                    },
                    {
                        question: "20. æœ€çµ‚è©•å¯©å°ä½ é€²è¡Œäº†å®šç¾©ï¼Œå®£å¸ƒä½ å±¬æ–¼æŸç¨®ã€Œé£Ÿç‰©äººæ ¼ã€ã€‚ä½ çš„åæ‡‰æ˜¯ï¼Ÿ",
                        options: [
                            { text: "æ¥å—é€™å€‹å®šç¾©ï¼ŒåŠªåŠ›åšå¥½è‡ªå·±", scores: { mbti: { I: 1, S: 2, F: 1, J: 1 }, enneagram: { 9: 2, 6: 1 } } },
                            { text: "æŒ‘æˆ°è©•å¯©ï¼Œè­‰æ˜è‡ªå·±ä¸åŒ", scores: { mbti: { E: 1, N: 1, T: 2, J: 1 }, enneagram: { 8: 2, 1: 1 } } },
                            { text: "é‡æ–°å®šç¾©è‡ªå·±ï¼Œé–‹å‰µæ–°è·¯", scores: { mbti: { I: 1, N: 2, F: 1, P: 1 }, enneagram: { 4: 2, 7: 1 } } },
                            { text: "ç¬‘çœ‹çµæœï¼Œéš¨ç·£è‡ªåœ¨", scores: { mbti: { E: 1, N: 2, F: 1, P: 1 }, enneagram: { 7: 2, 9: 1 } } }
                        ]
                    }
                ]
            }
        ];
        // Define food personalities (replace with your actual data)
        const foodPersonalities = {
            popcorn: { 
                name: "çˆ†ç±³èŠ±", 
                emoji: "ğŸ¿",
                description: "ä½ æ˜¯å……æ»¿æ´»åŠ›å’Œç¤¾äº¤é­…åŠ›çš„çˆ†ç±³èŠ±ï¼ä½ ç†±æ„›è‡ªç”±ï¼Œå–œæ­¡åœ¨äººç¾¤ä¸­æˆç‚ºç„¦é»ï¼Œç¸½èƒ½å¸¶ä¾†æ­¡æ¨‚å’Œè¼•é¬†çš„æ°›åœã€‚ä½ çš„é©æ‡‰åŠ›å¼·ï¼Œæ¨‚æ–¼æ¥å—æ–°äº‹ç‰©ï¼Œç”Ÿæ´»å°ä½ ä¾†èªªå°±æ˜¯ä¸€å ´å ´ç²¾å½©çš„æ´¾å°ã€‚"
            },
            blackCoffee: { 
                name: "é»‘å’–å•¡", 
                emoji: "â˜•",
                description: "ä½ æ˜¯æ·±é‚ƒè€Œç¨ç«‹çš„é»‘å’–å•¡ã€‚ä½ æ³¨é‡æ·±åº¦å’Œæœ¬è³ªï¼Œå–œæ­¡ç¨è‡ªæ€è€ƒï¼Œè¿½æ±‚çŸ¥è­˜å’ŒçœŸç†ã€‚ä½ å¯èƒ½ä¸å–„è¨€è¾­ï¼Œä½†å…§å¿ƒè±å¯Œï¼Œä¸€æ—¦èªå®šç›®æ¨™ä¾¿æœƒå°ˆæ³¨æŠ•å…¥ã€‚ä½ çè¦–æ¸…æ™°èˆ‡æ•ˆç‡ï¼Œè¨å­å†—é¤˜èˆ‡è†šæ·ºã€‚"
            },
            tofuPudding: { 
                name: "è±†èŠ±", 
                emoji: "ğŸ®",
                description: "ä½ æ˜¯æº«æ½¤å¦‚ç‰çš„è±†èŠ±ã€‚ä½ å–„è‰¯ã€æº«å’Œï¼Œå¯Œæœ‰åŒæƒ…å¿ƒï¼Œç¸½æ˜¯æ¨‚æ–¼å¹«åŠ©ä»–äººã€‚ä½ è¿½æ±‚å’Œè«§èˆ‡å…§å¿ƒçš„å¹³éœï¼Œä¸å–œæ­¡è¡çªï¼Œæ˜¯æœ‹å‹åœˆä¸­çš„æ½¤æ»‘åŠ‘ã€‚ä½ ç´°è†©çš„æƒ…æ„Ÿè®“ä½ èƒ½å¤ æ•éŠ³åœ°æ„ŸçŸ¥ä»–äººçš„éœ€æ±‚ã€‚"
            },
            grilledCheeseSandwich: { 
                name: "èµ·å¸çƒ¤ä¸‰æ˜æ²»", 
                emoji: "ğŸ¥ª",
                description: "ä½ æ˜¯æº«æš–è€Œå¯é çš„èµ·å¸çƒ¤ä¸‰æ˜æ²»ã€‚ä½ å‹™å¯¦ã€å¯é ï¼Œè…³è¸å¯¦åœ°ï¼Œæ˜¯è§£æ±ºå•é¡Œçš„é«˜æ‰‹ã€‚ä½ é‡è¦–å‚³çµ±å’Œç©©å®šï¼Œå–œæ­¡å°‡äº‹æƒ…åšå¾—æœ‰æ¢ä¸ç´Šã€‚ä½ å°è¦ªè¿‘çš„äººå……æ»¿å¿ èª ï¼Œæ˜¯å€¼å¾—ä¿¡è³´çš„ä¾é ã€‚"
            },
            macaron: { 
                name: "é¦¬å¡é¾", 
                emoji: " macarons",
                description: "ä½ æ˜¯è‰²å½©ç¹½ç´›ã€å……æ»¿å‰µæ„çš„é¦¬å¡é¾ã€‚ä½ æ“æœ‰è±å¯Œçš„æƒ³åƒåŠ›å’Œç¨ç‰¹çš„å¯©ç¾ï¼Œä¸å–œæ­¡å¢¨å®ˆæˆè¦ã€‚ä½ è¿½æ±‚å€‹äººè¡¨é”ï¼Œæƒ…æ„Ÿè±å¯Œä¸”è¤‡é›œï¼Œç¸½èƒ½åœ¨å¹³å‡¡ä¸­ç™¼ç¾ä¸å‡¡ä¹‹ç¾ã€‚ä½ æ¸´æœ›è¢«ç†è§£ï¼Œä¹Ÿæ¨‚æ–¼æ¢ç´¢æ–°å¥‡ã€‚"
            },
            cheeseFondue: { 
                name: "èµ·å¸ç«é‹", 
                emoji: "ğŸ§€",
                description: "ä½ æ˜¯å……æ»¿åŠ›é‡å’ŒæŒæ§æ…¾çš„èµ·å¸ç«é‹ã€‚ä½ è‡ªä¿¡ã€æœæ–·ï¼Œæœ‰å¼·çƒˆçš„é ˜å°æ…¾å’Œä¿è­·æ¬²ã€‚ä½ å–œæ­¡æŒ‘æˆ°ï¼Œä¸ç•å›°é›£ï¼Œé¡˜æ„ç‚ºè‡ªå·±å’Œåœ¨ä¹çš„äººå¥®é¬¥ã€‚ä½ ç›´æ¥ä¸”å¦ç‡ï¼Œæœ‰æ™‚å¯èƒ½é¡¯å¾—å¼·å‹¢ï¼Œä½†å…§å¿ƒå»å……æ»¿ç†±æƒ…ã€‚"
            },
            roastedSweetPotato: { 
                name: "çƒ¤åœ°ç“œ", 
                emoji: "ğŸ ",
                description: "ä½ æ˜¯æ¨¸å¯¦è€Œå¿ èª çš„çƒ¤åœ°ç“œã€‚ä½ ç©©é‡ã€è² è²¬ï¼Œé‡è¦–å®‰å…¨æ„Ÿå’Œæ­¸å±¬æ„Ÿã€‚ä½ å¯èƒ½æœ‰äº›è¬¹æ…ï¼Œä½†ä¸€æ—¦ä¿¡ä»»ä¾¿æœƒå…¨å¿ƒæŠ•å…¥ã€‚ä½ å‹¤æ‡‡è¸å¯¦ï¼Œæ˜¯å€‹å¯é çš„ç›Ÿå‹ï¼Œç¸½èƒ½åœ¨å±é›£æ™‚åˆ»çµ¦äºˆæ”¯æŒã€‚"
            },
            cottonCandy: { 
                name: "æ£‰èŠ±ç³–", 
                emoji: "ğŸ¬",
                description: "ä½ æ˜¯è¼•ç›ˆè€Œå¤¢å¹»çš„æ£‰èŠ±ç³–ã€‚ä½ è¿½æ±‚å…§å¿ƒçš„å’Œè«§èˆ‡å¯§éœï¼Œå–œæ­¡ç°¡å–®å’Œèˆ’é©çš„ç”Ÿæ´»ã€‚ä½ å‚¾å‘æ–¼é¿å…è¡çªï¼Œæ“…é•·å”èª¿èˆ‡åŒ…å®¹ã€‚ä½ å¯èƒ½æœ‰äº›éš¨æ€§ï¼Œä½†ç¸½æ˜¯çµ¦äººå¸¶ä¾†è¼•é¬†æ„‰å¿«çš„æ„Ÿè¦ºã€‚"
            },
            zucchini: { 
                name: "æ«›ç“œ", 
                emoji: "ğŸ¥’",
                description: "ä½ æ˜¯æ¸…çˆ½è€Œå…§æ–‚çš„æ«›ç“œã€‚ä½ å–œæ­¡ä¿æŒç¨ç«‹ï¼Œä¸æ„›å¼µæšï¼Œæ³¨é‡å…§åœ¨çš„æˆé•·å’Œè‡ªæˆ‘å®Œå–„ã€‚ä½ è§€å¯ŸåŠ›æ•éŠ³ï¼Œå–„æ–¼åˆ†æï¼Œæœ‰è‘—ç¨ç‰¹çš„è¦–è§’ã€‚ä½ å°æ–°çŸ¥å……æ»¿å¥½å¥‡ï¼Œæ˜¯å€‹ä¸æ–·å­¸ç¿’çš„æ¢ç©¶è€…ã€‚"
            }
        };
        const allFoodKeys = Object.keys(foodPersonalities);


        // Event Listeners
        startQuizBtn.addEventListener('click', startQuiz);
        nextStageBtn.addEventListener('click', navigateStage);
        prevStageBtn.addEventListener('click', navigateStage);
        restartQuizBtn.addEventListener('click', restartQuiz);
        saveResultImageBtn.addEventListener('click', saveResultImage);

        // Initial setup on page load
        document.addEventListener('DOMContentLoaded', () => {
            showIntroScreen();
        });

        // Function to show intro screen and initial disclaimer
        function showIntroScreen() {
            introContainer.classList.remove('hidden');
            quizContainer.classList.add('hidden');
            resultContainer.classList.add('hidden');
            disclaimerText.classList.remove('hidden'); // Ensure disclaimer is visible
            disclaimerContent.innerHTML = introDisclaimerHTML; // Set intro disclaimer content
            userNameInput.value = ''; // Clear username input
            userName = ''; // Clear username variable
            window.scrollTo(0, 0); // Scroll to top
        }

        // Start Quiz
        function startQuiz() {
            userName = userNameInput.value.trim();
            
            introContainer.classList.add('hidden');
            quizContainer.classList.remove('hidden');
            disclaimerText.classList.add('hidden'); // Hide disclaimer during quiz

            currentStageIndex = 0;
            userAnswers = {}; // Reset all answers
            mbtiScores = { E: 0, I: 0, S: 0, N: 0, T: 0, F: 0, J: 0, P: 0 };
            enneagramScores = { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0, 7: 0, 8: 0, 9: 0 };
            renderStage();
            window.scrollTo(0, 0); // Scroll to top
        }

        // Render current stage's questions and options
        function renderStage() {
            const currentStage = stages[currentStageIndex];
            currentStageContent.innerHTML = ''; // Clear old content

            // Add stage intro
            const introDiv = document.createElement('div');
            introDiv.classList.add('stage-intro');
            introDiv.innerHTML = currentStage.intro;
            currentStageContent.appendChild(introDiv);

            // Iterate through all questions in the current stage
            currentStage.questions.forEach((qData, qIndexInStage) => {
                // Calculate the global index of this question in the total `questions` list
                const questionGlobalIndex = getQuestionGlobalIndex(currentStageIndex, qIndexInStage);

                const questionBlock = document.createElement('div');
                questionBlock.classList.add('question-block');

                const qText = document.createElement('p');
                qText.classList.add('question-text');
                qText.innerHTML = qData.question;
                questionBlock.appendChild(qText);

                const optionsDiv = document.createElement('div');
                optionsDiv.classList.add('options-container');

                qData.options.forEach((option, optionIndex) => {
                    const button = document.createElement('button');
                    button.classList.add('option-btn');
                    button.innerText = option.text;
                    // Store global question index and option index
                    button.dataset.questionGlobalIndex = questionGlobalIndex;
                    button.dataset.optionIndex = optionIndex;
                    button.dataset.mbti = JSON.stringify(option.scores.mbti);
                    button.dataset.enneagram = JSON.stringify(option.scores.enneagram);

                    // If this question was previously answered, mark it as selected
                    if (userAnswers[questionGlobalIndex] === optionIndex) {
                        button.classList.add('selected');
                    }

                    button.addEventListener('click', selectOption);
                    optionsDiv.appendChild(button);
                });
                questionBlock.appendChild(optionsDiv);
                currentStageContent.appendChild(questionBlock);
            });

            updateNavigationButtons();
            window.scrollTo(0, 0); // Scroll to top every time a new stage is rendered
        }

        // Display and functionality of navigation buttons
        function updateNavigationButtons() {
            // Previous stage button
            if (currentStageIndex === 0) {
                prevStageBtn.classList.add('hidden');
            } else {
                prevStageBtn.classList.remove('hidden');
                prevStageBtn.innerText = 'ä¸Šä¸€éšæ®µ';
                prevStageBtn.dataset.direction = 'prev';
            }

            // Next stage/View Result button
            if (currentStageIndex === stages.length - 1) {
                nextStageBtn.innerText = 'æŸ¥çœ‹çµæœ';
                nextStageBtn.dataset.direction = 'result';
            } else {
                nextStageBtn.innerText = 'ä¸‹ä¸€éšæ®µ';
                nextStageBtn.dataset.direction = 'next';
            }
            nextStageBtn.classList.remove('hidden'); // Ensure next stage button is always visible
        }

        // Option click event
        function selectOption(event) {
            const clickedButton = event.target;
            const questionGlobalIndex = parseInt(clickedButton.dataset.questionGlobalIndex);
            const optionIndex = parseInt(clickedButton.dataset.optionIndex);

            // Get all option buttons for the current question
            const optionsContainer = clickedButton.closest('.options-container');
            const allOptionButtons = Array.from(optionsContainer.children);

            // If the clicked option is already selected, unselect it
            if (clickedButton.classList.contains('selected')) {
                clickedButton.classList.remove('selected');
                delete userAnswers[questionGlobalIndex]; // Remove this question from answers
            } else {
                // Otherwise, unselect other options
                allOptionButtons.forEach(btn => btn.classList.remove('selected'));
                // Select the currently clicked option
                clickedButton.classList.add('selected');
                // Store user's answer
                userAnswers[questionGlobalIndex] = optionIndex;
            }
        }

        // Navigation logic (Next Stage/Previous Stage/View Result)
        function navigateStage(event) {
            const direction = event.target.dataset.direction;

            if (direction === 'prev') {
                currentStageIndex--;
                renderStage();
            } else {
                // Before moving to the next stage or showing results, check if all questions in the current stage are answered
                const currentStageQuestions = stages[currentStageIndex].questions;
                let allAnswered = true;
                for (let i = 0; i < currentStageQuestions.length; i++) {
                    const globalIndex = getQuestionGlobalIndex(currentStageIndex, i);
                    if (userAnswers[globalIndex] === undefined) {
                        allAnswered = false;
                        break;
                    }
                }

                if (!allAnswered) {
                    alert('è«‹å›ç­”æœ¬éšæ®µæ‰€æœ‰å•é¡Œå¾Œå†é€²å…¥ä¸‹ä¸€éšæ®µï¼');
                    return;
                }

                if (direction === 'next') {
                    currentStageIndex++;
                    renderStage();
                } else if (direction === 'result') {
                    calculateAndShowResult();
                }
            }
        }

        // Recalculate all scores based on user answers
        function recalculateScores() {
            // Reset all scores
            mbtiScores = { E: 0, I: 0, S: 0, N: 0, T: 0, F: 0, J: 0, P: 0 };
            enneagramScores = { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0, 7: 0, 8: 0, 9: 0 };

            // Iterate through all questions in all stages and accumulate scores based on userAnswers
            let globalQuestionCounter = 0;
            stages.forEach(stage => {
                stage.questions.forEach((qData) => {
                    const selectedOptionIndex = userAnswers[globalQuestionCounter];
                    if (selectedOptionIndex !== undefined) {
                        const selectedOption = qData.options[selectedOptionIndex];
                        // Accumulate MBTI scores
                        const mbtiImpact = selectedOption.scores.mbti;
                        for (const char in mbtiImpact) {
                            mbtiScores[char] += mbtiImpact[char];
                        }
                        // Accumulate Enneagram scores
                        const enneagramImpact = selectedOption.scores.enneagram;
                        for (const type in enneagramImpact) {
                            enneagramScores[type] += enneagramImpact[type];
                        }
                    }
                    globalQuestionCounter++;
                });
            });
        }

        // Helper function: Get global index of a question
        function getQuestionGlobalIndex(stageIndex, questionIndexInStage) {
            let globalIndex = 0;
            for (let i = 0; i < stageIndex; i++) {
                globalIndex += stages[i].questions.length;
            }
            globalIndex += questionIndexInStage;
            return globalIndex;
        }

        // Calculate final MBTI type
        function calculateMBTI() {
            let mbtiType = "";
            mbtiType += (mbtiScores.E >= mbtiScores.I) ? 'E' : 'I';
            mbtiType += (mbtiScores.S >= mbtiScores.N) ? 'S' : 'N';
            mbtiType += (mbtiScores.T >= mbtiScores.F) ? 'T' : 'F';
            mbtiType += (mbtiScores.J >= mbtiScores.P) ? 'J' : 'P';
            return mbtiType;
        }

        // Calculate final Enneagram type
        function calculateEnneagram() {
            let maxScore = -1;
            let finalEnneagramType = 'æœªçŸ¥';

            const enneagramEntries = Object.entries(enneagramScores);

            // Sort by score in descending order, if scores are equal, sort by type number in ascending order (e.g., 1 before 7)
            enneagramEntries.sort((a, b) => {
                if (b[1] === a[1]) {
                    return parseInt(a[0]) - parseInt(b[0]); // If scores are equal, smaller number takes precedence
                }
                return b[1] - a[1]; // Higher score takes precedence
            });

            if (enneagramEntries.length > 0) {
                finalEnneagramType = enneagramEntries[0][0]; // Take the type with the highest score (or smallest number among tied highest)
            }

            return finalEnneagramType + 'è™Ÿ';
        }

        // Display results
        function calculateAndShowResult() {
            recalculateScores(); // Recalculate all scores before displaying results

            quizContainer.classList.add('hidden');
            resultContainer.classList.remove('hidden');
            disclaimerText.classList.remove('hidden'); // Ensure disclaimer is visible
            disclaimerContent.innerHTML = resultDisclaimerHTML; // Set result disclaimer content
            window.scrollTo(0, 0); // Scroll to top

            const finalMBTI = calculateMBTI();
            const finalEnneagram = calculateEnneagram();
            console.log("æœ€çµ‚ MBTI é¡å‹: ", finalMBTI);
            console.log("æœ€çµ‚ä¹å‹äººæ ¼é¡å‹: ", finalEnneagram);
            console.log("MBTI åŸå§‹åˆ†æ•¸: ", mbtiScores);
            console.log("ä¹å‹äººæ ¼åŸå§‹åˆ†æ•¸: ", enneagramScores);

            let finalFoodPersonalityKey;

            // More complex food personality determination logic, combining MBTI and Enneagram tendencies
            // More conditions can be added here to make the results more precise and interesting
            // Example:
            if (mbtiScores.E > mbtiScores.I && enneagramScores[7] > enneagramScores[4]) {
                finalFoodPersonalityKey = 'popcorn'; // Extroverted, pleasure-seeking
            } else if (mbtiScores.I > mbtiScores.E && enneagramScores[5] > enneagramScores[1]) {
                finalFoodPersonalityKey = 'blackCoffee'; // Introverted, analytical, seeking knowledge
            } else if (mbtiScores.F > mbtiScores.T && enneagramScores[2] > enneagramScores[9]) {
                finalFoodPersonalityKey = 'tofuPudding'; // Emotional, helpful, gentle
            } else if (mbtiScores.S > mbtiScores.N && enneagramScores[1] > enneagramScores[8]) {
                finalFoodPersonalityKey = 'grilledCheeseSandwich'; // Practical, pragmatic, reliable
            } else if (mbtiScores.N > mbtiScores.S && enneagramScores[4] > enneagramScores[7]) {
                finalFoodPersonalityKey = 'macaron'; // Intuitive, unique, creative
            } else if (enneagramScores[8] > enneagramScores[3] && mbtiScores.T > mbtiScores.F) {
                finalFoodPersonalityKey = 'cheeseFondue'; // Controlling, powerful, more thinking-oriented
            } else if (enneagramScores[6] > enneagramScores[9] && mbtiScores.J > mbtiScores.P) {
                finalFoodPersonalityKey = 'roastedSweetPotato'; // Loyal, seeking security, more judging-oriented
            } else if (enneagramScores[9] > enneagramScores[6] && mbtiScores.F > mbtiScores.T) {
                finalFoodPersonalityKey = 'cottonCandy'; // Peaceful, conflict-avoidant, more feeling-oriented
            } else if (mbtiScores.I > mbtiScores.E && mbtiScores.T > mbtiScores.F && enneagramScores[5] > enneagramScores[9]) {
                finalFoodPersonalityKey = 'zucchini'; // Introverted, thinking, observer
            } else {
                // As a last resort fallback, if no clear match, determine based on MBTI main tendency and Enneagram secondary tendency
                // This part can be further refined to ensure all combinations fall into a food personality
                if (finalMBTI.includes('E') && finalMBTI.includes('P')) {
                    finalFoodPersonalityKey = 'popcorn'; // Extroverted, perceiving, loves freedom
                } else if (finalMBTI.includes('I') && finalMBTI.includes('J')) {
                    finalFoodPersonalityKey = 'blackCoffee'; // Introverted, judging, calm and rational
                } else if (finalMBTI.includes('F') && finalMBTI.includes('S')) {
                    finalFoodPersonalityKey = 'tofuPudding'; // Feeling, sensing, gentle and considerate
                } else if (finalMBTI.includes('T') && finalMBTI.includes('N')) {
                    finalFoodPersonalityKey = 'zucchini'; // Thinking, intuitive, analytical depth
                } else if (finalMBTI.includes('E') && finalMBTI.includes('J')) {
                    finalFoodPersonalityKey = 'cheeseFondue'; // Extroverted, judging, organized
                } else if (finalMBTI.includes('I') && finalMBTI.includes('P')) {
                    finalFoodPersonalityKey = 'cottonCandy'; // Introverted, perceiving, casual and dreamy
                } else {
                    // As a final fallback, if no clear match, randomly assign
                    const keys = Object.keys(foodPersonalities);
                    finalFoodPersonalityKey = keys[Math.floor(Math.random() * keys.length)];
                }
            }

            const matchedFood = foodPersonalities[finalFoodPersonalityKey];
            if (!matchedFood) {
                console.error("æœªæ‰¾åˆ°å°æ‡‰çš„é£Ÿç‰©äººæ ¼ï¼éŒ¯èª¤çš„ key:", finalFoodPersonalityKey);
                document.getElementById('final-food-personality').innerText = "Oooops! ç™¼ç”ŸéŒ¯èª¤äº†ï¼";
                document.getElementById('food-personality-description').innerText = "è«‹ç¨å¾Œå†è©¦ã€‚";
                return;
            }

            document.getElementById('final-food-personality').innerHTML = `<span class="emoji">${matchedFood.emoji}</span> ${matchedFood.name}`;
            document.getElementById('food-personality-description').innerText = matchedFood.description;

            const otherFoodKeys = allFoodKeys.filter(key => key !== finalFoodPersonalityKey);
            const suitableFoodsKeys = getRandomElements(otherFoodKeys, Math.floor(Math.random() * 2) + 2); // 2 to 3
            const remainingFoodKeysForUnsuitable = otherFoodKeys.filter(key => !suitableFoodsKeys.includes(key));
            const unsuitableFoodsKeys = getRandomElements(remainingFoodKeysForUnsuitable, Math.floor(Math.random() * 2) + 2); // 2 to 3

            const suitableFoodsList = document.getElementById('suitable-foods-with-reason');
            suitableFoodsList.innerHTML = '';
            if (suitableFoodsKeys.length > 0) {
                suitableFoodsKeys.forEach(foodKey => {
                    const compatibleFood = foodPersonalities[foodKey];
                    if (compatibleFood) {
                        const reason = getRandomCompatibilityReason(matchedFood.name, compatibleFood.name, 'é©åˆ');
                        const li = document.createElement('li');
                        // Add emoji
                        li.innerHTML = `<strong>${compatibleFood.name} <span class="emoji">${compatibleFood.emoji}</span></strong>ï¼š${reason}`;
                        suitableFoodsList.appendChild(li);
                    }
                });
            } else {
                suitableFoodsList.innerHTML = '<li>ç›®å‰æ²’æœ‰ç‰¹åˆ¥åˆæ‹çš„é£Ÿç‰©ã€‚</li>';
            }

            const unsuitableFoodsList = document.getElementById('unsuitable-foods-with-reason');
            unsuitableFoodsList.innerHTML = '';
            if (unsuitableFoodsKeys.length > 0) {
                unsuitableFoodsKeys.forEach(foodKey => {
                    const incompatibleFood = foodPersonalities[foodKey];
                    if (incompatibleFood) {
                        const reason = getRandomCompatibilityReason(matchedFood.name, incompatibleFood.name, 'ä¸é©åˆ');
                        const li = document.createElement('li');
                        // Add emoji
                        li.innerHTML = `<strong>${incompatibleFood.name} <span class="emoji">${incompatibleFood.emoji}</span></strong>ï¼š${reason}`;
                        unsuitableFoodsList.appendChild(li);
                    }
                });
            } else {
                unsuitableFoodsList.innerHTML = '<li>ç›®å‰æ²’æœ‰ç‰¹åˆ¥éœ€è¦å¤šé»ç†è§£çš„é£Ÿç‰©ã€‚</li>';
            }

            // Set up event listeners for feedback buttons
            const feedbackButtons = document.querySelectorAll('#feedback-section .feedback-buttons button');
            feedbackButtons.forEach(button => {
                // Reset button state
                button.classList.remove('active');
                button.disabled = false;

                // Create a new event listener. This ensures the correct closure for matchedFood.name, finalMBTI, finalEnneagram
                // Clone and replace to remove old listeners effectively
                const oldButton = button;
                const newButton = oldButton.cloneNode(true);
                oldButton.parentNode.replaceChild(newButton, oldButton);
                newButton.addEventListener('click', (event) => {
                    handleFeedback(event.target.dataset.feedback, event.target, matchedFood.name, finalMBTI, finalEnneagram);
                });
            });
        }

        // Restart Quiz
        function restartQuiz() {
            // Reload the page for a clean restart
            location.reload(); 
        }

        // Helper function: Get N random unique elements from an array
        function getRandomElements(arr, num) {
            const shuffled = [...arr].sort(() => 0.5 - Math.random());
            return shuffled.slice(0, num);
        }

        // Helper function: Generate random compatibility reason
        function getRandomCompatibilityReason(foodA, foodB, type) {
            const compatibleReasons = [
                `${foodB}çš„ç‰¹è³ªèƒ½å·§å¦™åœ°è£œè¶³ä½ çš„å„ªå‹¢ï¼Œè®“ä½ å€‘çš„çµ„åˆæ›´åŠ åœ“æ»¿ã€‚`,
                `ä½ å€‘åœ¨æŸäº›éš±ç´„çš„å±¤é¢æœ‰è‘—ç›¸ä¼¼çš„é »ç‡ï¼Œç¸½èƒ½è¼•æ˜“ç†è§£å½¼æ­¤ã€‚`,
                `åœ¨ä¸€èµ·æ™‚ï¼Œ${foodB}èƒ½ç‚ºä½ å¸¶ä¾†æ„æƒ³ä¸åˆ°çš„éˆæ„Ÿï¼Œæ¿€ç™¼æ›´å¤šå¯èƒ½æ€§ã€‚`,
                `ä½ å’Œ${foodB}çš„èƒ½é‡èƒ½å¤ ç›¸äº’æµå‹•ï¼Œå‰µé€ å‡ºèˆ’é©ä¸”å……æ»¿æ­£å‘æ°›åœçš„ç©ºé–“ã€‚`,
                `åœ¨é¢å°æŒ‘æˆ°æ™‚ï¼Œä½ å€‘èƒ½ä»¥ç¨ç‰¹çš„æ–¹å¼äº’ç›¸æ”¯æŒï¼Œå…±åŒå…‹æœå›°é›£ã€‚`,
                `èˆ‡${foodB}ç›¸è™•ï¼Œä½ ç¸½èƒ½æ„Ÿå—åˆ°ä¸€ä»½è‡ªç„¶è€Œç„¶çš„é»˜å¥‘ï¼Œå½¼æ­¤å¿ƒç…§ä¸å®£ã€‚`,
                `${foodB}çš„å­˜åœ¨èƒ½è®“ä½ æ„Ÿåˆ°æ”¾é¬†èˆ‡è‡ªåœ¨ï¼Œæ˜¯é›£å¾—çš„éˆé­‚ä¼´ä¾¶ã€‚`
            ];
            const incompatibleReasons = [
                `ä½ å’Œ${foodB}çš„è¡Œäº‹é¢¨æ ¼å¯èƒ½å¤§ç›¸å¾‘åº­ï¼Œéœ€è¦å¤šèŠ±æ™‚é–“ç£¨åˆèˆ‡æºé€šã€‚`,
                `åœ¨æŸäº›é‡è¦æ™‚åˆ»ï¼Œä½ å€‘çš„å„ªå…ˆé †åºå¯èƒ½æœƒæœ‰æ˜é¡¯å·®ç•°ï¼Œéœ€è¦æ›´å¤šçš„ç†è§£ã€‚`,
                `${foodB}çš„æŸäº›ç‰¹è³ªå¯èƒ½æœƒè®“ä½ æ„Ÿåˆ°äº›è¨±å£“åŠ›ï¼Œæˆ–è®“ä½ çš„å…§å¿ƒç”¢ç”Ÿå¾®å¦™çš„æŠ—æ‹’ã€‚`,
                `ç›¸è™•æ™‚ï¼Œä½ å€‘çš„èƒ½é‡å ´å¯èƒ½ä¸å¤ªå”èª¿ï¼Œå®¹æ˜“å‡ºç¾å°å°çš„æ‘©æ“¦ã€‚`,
                `ä½ å€‘å¯èƒ½åœ¨çœ‹å¾…äº‹ç‰©çš„è§’åº¦ä¸Šå­˜åœ¨æ ¹æœ¬å·®ç•°ï¼Œé€™æœ‰æ™‚æœƒå°è‡´èªçŸ¥ä¸Šçš„è½å·®ã€‚`,
                `èˆ‡${foodB}äº¤æµæ™‚ï¼Œä½ å¯èƒ½éœ€è¦èŠ±æ›´å¤šåŠ›æ°£å»é©æ‡‰å°æ–¹çš„ç¯€å¥ã€‚`,
                `ä½ å€‘çš„ç›¸è™•æ¨¡å¼å¯èƒ½å­˜åœ¨ä¸€äº›éœ€è¦ç‰¹åˆ¥ç•™æ„çš„åœ°æ–¹ï¼Œå¦å‰‡å®¹æ˜“ç”¢ç”Ÿèª¤æœƒã€‚`
            ];
            let reasonsArray;
            if (type === 'é©åˆ') {
                reasonsArray = compatibleReasons;
            } else if (type === 'ä¸é©åˆ') {
                reasonsArray = incompatibleReasons;
            } else {
                return "æœªçŸ¥åŸå› ";
            }
            const randomIndex = Math.floor(Math.random() * reasonsArray.length);
            return reasonsArray[randomIndex];
        }

        // Save image function
        function saveResultImage() {
            const resultElement = document.getElementById('result-container');
            
            // Store original styles for restoration
            const containerElement = document.querySelector('.container');
            const originalContainerPadding = containerElement.style.padding;
            const originalContainerShadow = containerElement.style.boxShadow;
            const originalContainerMask = containerElement.style.getPropertyValue('-webkit-mask');
            const originalContainerMaskComposite = containerElement.style.getPropertyValue('mask-composite');
            const originalBodyOverflow = document.body.style.overflow;
            
            // Find feedback section and store its original display state
            const feedbackSection = document.getElementById('feedback-section');
            // Hide the single disclaimer text as well
            const originalDisclaimerDisplay = disclaimerText.style.display;

            // Temporarily hide elements that shouldn't be in the screenshot
            if (feedbackSection) feedbackSection.style.display = 'none';
            saveResultImageBtn.classList.add('hidden'); // Hide the save button itself
            restartQuizBtn.classList.add('hidden'); // Hide the original restart button
            disclaimerText.style.display = 'none'; // Hide the disclaimer for screenshot

            // Adjust styles for optimal screenshot
            document.body.style.overflow = 'hidden'; // Prevent scrollbar from affecting screenshot
            containerElement.style.padding = '50px'; // Increase padding for screenshot
            containerElement.style.boxShadow = 'none'; // Temporarily remove shadow
            containerElement.style.setProperty('-webkit-mask', 'none'); // Remove gradient border
            containerElement.style.setProperty('mask-composite', 'unset');

            // Show a loading message
            const loadingMessage = document.createElement('div');
            loadingMessage.textContent = 'åœ–ç‰‡ç”Ÿæˆä¸­ï¼Œè«‹ç¨å€™...';
            loadingMessage.style.cssText = 'position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: rgba(0,0,0,0.7); color: white; padding: 15px 25px; border-radius: 10px; z-index: 1000;';
            document.body.appendChild(loadingMessage);

            html2canvas(resultElement, {
                useCORS: true,
                allowTaint: true,
                scale: 2, // Keep this setting, consider increasing to 3 if quality is insufficient
                backgroundColor: null // Make background transparent
            }).then(canvas => {
                // Remove loading message
                document.body.removeChild(loadingMessage);

                const dataURL = canvas.toDataURL('image/png');

                // Create a new image element to display the result
                const img = document.createElement('img');
                img.src = dataURL;
                img.style.maxWidth = '100%';
                img.style.height = 'auto';
                img.style.display = 'block'; // Ensure image is displayed

                // Remove original result page content, display image
                resultElement.innerHTML = ''; // Clear result container
                resultElement.appendChild(img); // Add image to result container

                // Add save prompt and action buttons
                const savePrompt = document.createElement('p');
                savePrompt.innerHTML = '<br><strong>âœ¨ åœ–ç‰‡å·²ç”Ÿæˆï¼</strong><br>åœ¨æ‰‹æ©Ÿä¸Šè«‹ã€Œé•·æŒ‰åœ–ç‰‡ã€å„²å­˜æˆ–åˆ†äº«ã€‚<br>åœ¨é›»è…¦ä¸Šå¯å³éµå¦å­˜åœ–ç‰‡ã€‚';
                savePrompt.style.cssText = 'margin-top: 20px; font-size: 1.1em; color: var(--text-dark); line-height: 1.6;';
                resultElement.appendChild(savePrompt);

                const buttonContainer = document.createElement('div');
                buttonContainer.style.cssText = 'display: flex; justify-content: center; gap: 15px; margin-top: 20px;';

                const downloadBtn = document.createElement('a'); // Still provide download button as fallback
                downloadBtn.href = dataURL;
                downloadBtn.download = `${userName ? userName + '_' : ''}æˆ‘çš„é£Ÿç‰©äººæ ¼æ¸¬é©—çµæœ_${new Date().toLocaleDateString().replace(/\//g, '-')}.png`;
                downloadBtn.textContent = 'é»æ“Šä¸‹è¼‰åœ–ç‰‡ (å‚™ç”¨)';
                downloadBtn.className = 'stage-nav-btn'; // Use existing button style
                downloadBtn.style.background = 'linear-gradient(45deg, #1976D2, #2196F3)'; // Blue tone
                downloadBtn.style.maxWidth = '200px'; // Limit width
                downloadBtn.style.margin = '0 auto'; // Center
                downloadBtn.target = '_blank'; // Open in new tab for download, supported by some browsers
                
                // New restart quiz button after image generation
                const newRestartBtn = document.createElement('button');
                newRestartBtn.textContent = 'é‡æ–°æ¸¬é©—';
                newRestartBtn.id = 'restartQuizBtnNew'; // Ensure ID doesn't conflict
                newRestartBtn.className = 'stage-nav-btn';
                newRestartBtn.style.background = 'linear-gradient(45deg, #FF5722, #FF8A00)'; // Orange tone
                newRestartBtn.style.maxWidth = '200px';
                newRestartBtn.style.margin = '0 auto';
                newRestartBtn.addEventListener('click', restartQuiz); // Bind restart function

                buttonContainer.appendChild(downloadBtn);
                buttonContainer.appendChild(newRestartBtn);
                resultElement.appendChild(buttonContainer);

            }).catch(error => {
                // Remove loading message
                document.body.removeChild(loadingMessage);
                console.error("åœ–ç‰‡å„²å­˜å¤±æ•—ï¼š", error);
                alert("åœ–ç‰‡ç”Ÿæˆå¤±æ•—ï¼Œè«‹é‡è©¦æˆ–æª¢æŸ¥ç€è¦½å™¨æ¬Šé™ã€‚\néŒ¯èª¤è¨Šæ¯: " + error.message);
            }).finally(() => {
                // Restore original styles (except for the elements that were intentionally replaced/re-added)
                document.body.style.overflow = originalBodyOverflow;
                containerElement.style.padding = originalContainerPadding;
                containerElement.style.boxShadow = originalContainerShadow;
                containerElement.style.setProperty('-webkit-mask', originalContainerMask);
                containerElement.style.setProperty('mask-composite', originalContainerMaskComposite);
                
                // Restore the disclaimer's display state only if it was hidden for screenshot
                disclaimerText.style.display = originalDisclaimerDisplay;
            });
        }

        // Handle Feedback (visual change only, actual application needs to send data to backend)
        function handleFeedback(feedbackType, buttonElement, foodPersonality, mbtiType, enneagramType) {
            const feedbackButtonsContainer = document.querySelector('.feedback-buttons');
            for (let btn of feedbackButtonsContainer.children) {
                btn.classList.remove('active');
                btn.disabled = true; // Disable all feedback buttons after selection
            }
            buttonElement.classList.add('active'); // Mark the selected button
            
            // Prepare data to send, including userName
            const dataToSend = {
                userName: userName, // Add name
                foodPersonality: foodPersonality,
                mbtiType: mbtiType,
                enneagramType: enneagramType,
                feedback: feedbackType 
            };

            const backendApiUrl = 'https://food-quiz-python-backend.onrender.com/api/feedback'; 

            fetch(backendApiUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(dataToSend), 
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                console.log('å¾Œç«¯å›å‚³:', data);
                // Optionally, show a "Thank you" message to the user
                const feedbackSection = document.getElementById('feedback-section');
                if (feedbackSection) {
                    feedbackSection.innerHTML = '<p style="font-size: 1.1em; color: var(--secondary-color); font-weight: bold; margin-top: 15px;">æ„Ÿè¬æ‚¨çš„å›é¥‹ï¼</p>';
                }
            })
            .catch((error) => {
                console.error('ç™¼é€å›é¥‹å¤±æ•—:', error);
                const feedbackSection = document.getElementById('feedback-section');
                if (feedbackSection) {
                    feedbackSection.innerHTML = '<p style="font-size: 1.1em; color: var(--primary-color); font-weight: bold; margin-top: 15px;">å›é¥‹ç™¼é€å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚</p>';
                }
            });
        }
    </script>
</body>
</html>
